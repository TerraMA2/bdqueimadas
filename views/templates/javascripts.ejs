<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
<!-- jQuery 2.1.4 -->
<script type="text/javascript" src="/externals/jQuery/jQuery-2.1.4.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script type="text/javascript" src="/externals/jQueryUI/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script type="text/javascript">
  $.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.5 -->
<script type="text/javascript" src="/externals/bootstrap/js/bootstrap.min.js"></script>
<!-- Sparkline -->
<script type="text/javascript" src="/externals/sparkline/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script type="text/javascript" src="/externals/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script type="text/javascript" src="/externals/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- jQuery Knob Chart -->
<script type="text/javascript" src="/externals/knob/jquery.knob.js"></script>
<!-- daterangepicker -->
<script type="text/javascript" src="/externals/daterangepicker/moment.min.js"></script>
<script type="text/javascript" src="/externals/daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script type="text/javascript" src="/externals/datepicker/bootstrap-datepicker.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script type="text/javascript" src="/externals/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- Slimscroll -->
<script type="text/javascript" src="/externals/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script type="text/javascript" src="/externals/fastclick/fastclick.min.js"></script>
<!-- AdminLTE App -->
<script type="text/javascript" src="/externals/adminlte/js/app.min.js"></script>
<!-- DataTables -->
<script type="text/javascript" src="/externals/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/externals/datatables/dataTables.bootstrap.min.js"></script>
<!-- ChartJS 1.0.1 -->
<script type="text/javascript" src="/externals/chartjs/Chart.min.js"></script>
<!-- InputMask -->
<script type="text/javascript" src="/externals/input-mask/jquery.inputmask.js"></script>
<script type="text/javascript" src="/externals/input-mask/jquery.inputmask.date.extensions.js"></script>
<script type="text/javascript" src="/externals/input-mask/jquery.inputmask.extensions.js"></script>
<!-- Malihu custom scrollbar plugin -->
<script type="text/javascript" src="/externals/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar.concat.min.js"></script>
<!-- Queimadas -->
<script type="text/javascript" src="/externals/adminlte/js/queimadas.js"></script>
<!-- OpenLayers  -->
<script type="text/javascript" src="/externals/openlayers/ol.js"></script>
<script type="text/javascript" src="/javascripts/BDQueimadas.js"></script>
<script type="text/javascript" src="<%= terrama2Path %>/javascripts/TerraMA2WebComponents.js"></script>
<script type="text/javascript">
  TerraMA2WebComponents.obj.init(
    "<%= terrama2Path %>",
    [
      "MapDisplay",
      "LayerExplorer"
    ]
  );

  var fillColors = {
    "0": "#FFEBCD",
    "100": "#FFC387",
    "500": "#FAA046",
    "1000": "#FA872D",
    "5000": "#FA5C25",
    "25000": "#C34231",
    "50000": "#A21C0D"
  };

  var strokeColors = {
    "0": "#000000",
    "100": "#000000",
    "500": "#000000",
    "1000": "#000000",
    "5000": "#000000",
    "25000": "#000000",
    "50000": "#000000"
  };

  BDQueimadas.obj.init(
    JSON.parse('<%- JSON.stringify(filterConfig) %>'),
    JSON.parse('<%- JSON.stringify(serverConfig) %>'),
    JSON.parse('<%- JSON.stringify(attributesTableConfig) %>'),
    JSON.parse('<%- JSON.stringify(componentsConfig) %>'),
    JSON.parse('<%- JSON.stringify(mapSubtitleConfig) %>')
  );

  var serverConfig = JSON.parse('<%- JSON.stringify(serverConfig) %>');
  var filterConfig = JSON.parse('<%- JSON.stringify(filterConfig) %>');

  var terrama2Interval = window.setInterval(function() {
    if(TerraMA2WebComponents.obj.isComponentsLoaded()) {

      /*TerraMA2WebComponents.webcomponents.MapDisplay.addGeoJSONVectorLayer(
        'http://localhost:38000/get-countries-layer-features',
        'countries',
        'countries',
        true,
        fillColors,
        strokeColors,
        function(feature, fill, stroke) {
          var colorSelector = "0";

          if(parseInt(feature.get('fires_count')) > 0 && parseInt(feature.get('fires_count')) <= 100) {
            colorSelector = "100";
          } else if(parseInt(feature.get('fires_count')) > 100 && parseInt(feature.get('fires_count')) <= 500) {
            colorSelector = "500";
          } else if(parseInt(feature.get('fires_count')) > 500 && parseInt(feature.get('fires_count')) <= 1000) {
            colorSelector = "1000";
          } else if(parseInt(feature.get('fires_count')) > 1000 && parseInt(feature.get('fires_count')) <= 5000) {
            colorSelector = "5000";
          } else if(parseInt(feature.get('fires_count')) > 5000 && parseInt(feature.get('fires_count')) <= 25000) {
            colorSelector = "25000";
          } else if(parseInt(feature.get('fires_count')) > 25000 && parseInt(feature.get('fires_count')) <= 50000) {
            colorSelector = "50000";
          }

          return {
            "fillColor": fill[colorSelector],
            "strokeColor": stroke[colorSelector]
          };
        }
      );*/

      TerraMA2WebComponents.webcomponents.MapDisplay.addTileWMSLayer(
        serverConfig.URL,
        serverConfig.Type,
        serverConfig.StatesLayerId,
        serverConfig.StatesLayerId,
        true,
        filterConfig.SpatialFilter.StatesMinimumResolution,
        filterConfig.SpatialFilter.StatesMaximumResolution
      );

      TerraMA2WebComponents.webcomponents.MapDisplay.addTileWMSLayer(
        serverConfig.URL,
        serverConfig.Type,
        serverConfig.CountriesLayerId,
        serverConfig.CountriesLayerId,
        true,
        filterConfig.SpatialFilter.CountriesMinimumResolution,
        filterConfig.SpatialFilter.CountriesMaximumResolution
      );

      TerraMA2WebComponents.webcomponents.MapDisplay.addTileWMSLayer(
        serverConfig.URL,
        serverConfig.Type,
        serverConfig.FiresLayerId,
        serverConfig.FiresLayerId,
        true,
        filterConfig.SpatialFilter.FiresMinimumResolution,
        filterConfig.SpatialFilter.FiresMaximumResolution
      );

      TerraMA2WebComponents.webcomponents.MapDisplay.addTileWMSLayer(
        serverConfig.URL,
        serverConfig.Type,
        serverConfig.FiresChoroplethLayerId,
        serverConfig.FiresChoroplethLayerId,
        true,
        filterConfig.SpatialFilter.FiresChoroplethMinimumResolution,
        filterConfig.SpatialFilter.FiresChoroplethMaximumResolution
      );

      TerraMA2WebComponents.webcomponents.LayerExplorer.addLayersFromMap('bases');

      TerraMA2WebComponents.webcomponents.MapDisplay.addCapabilitiesLayers(
        serverConfig.URL + serverConfig.CapabilitiesParams,
        serverConfig.URL,
        'geoserver',
        'local',
        'Local Server',
        function() {
          TerraMA2WebComponents.webcomponents.LayerExplorer.addLayersFromMap('local');
        }
      );

      clearInterval(terrama2Interval);
    }
  }, 10);

  var bdqueimadasInterval = window.setInterval(function() {
    if(BDQueimadas.obj.isComponentsLoaded()) {
      BDQueimadas.components.MapSubtitle.addSubtitle(serverConfig.FiresChoroplethLayerId);

      clearInterval(bdqueimadasInterval);
    }
  }, 10);
</script>
