<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../public/css/externals/openlayers/ol.css" type="text/css">
    <link rel="stylesheet" href="../public/css/externals/bootstrap/bootstrap-slider.css">
    <link rel="stylesheet" href="../public/css/externals/bootstrap/bootstrap.glyphicon.css">
    <link rel="stylesheet" href="../public/css/style.css">
    <link rel="stylesheet" href="../public/css/externals/jquery/jquery-ui.css">
    <link rel="stylesheet" href="../public/js/externals/jquery/DataTables-1.10.10/media/css/jquery.dataTables.css">
    <link rel="stylesheet" href="http://localhost/terrama2/webapp/public/css/terrama2.css">
    <script src="../public/js/externals/openlayers/ol.js" type="text/javascript"></script>
    <script src="../public/js/externals/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="../public/js/externals/jquery/jquery.mask.js" type="text/javascript"></script>
    <script src="../public/js/externals/jquery/jquery-ui.js" type="text/javascript"></script>
    <script src="../public/js/externals/jquery/DataTables-1.10.10/media/js/jquery.dataTables.js" type="text/javascript"></script>
    <script src="../public/js/externals/bootstrap/bootstrap-slider.js" type="text/javascript"></script>
    <script src="../public/js/externals/chart.js/Chart.min.js" type="text/javascript"></script>
    <title>Banco de Dados de Queimadasrs</title>
  </head>
  <body>
    <div id="gov-identity-bar"></div>
    <div class="banner">
      <div class="banner-title">BDQueimadas</div>
      <div class="banner-language">Idioma</div>
    </div>
    <div class="content">
      <div id="terrama2-container">
        <div id="terrama2-leftbar">
          <button class="terrama2-leftbar-button" title="Data" terrama2-box="terrama2-layerexplorer"></button>
          <button class="terrama2-leftbar-button" title="Data" terrama2-box="terrama2-filter"></button>
          <button class="terrama2-leftbar-button terrama2-leftbar-button-table" title="Data" terrama2-box="terrama2-table"></button>
          <button class="terrama2-leftbar-button" title="Data" terrama2-box="terrama2-graph">graph</button>
        </div>
        <div id="terrama2-layerexplorer" class="terrama2-leftbox terrama2-resizable-horizontal"></div>
        <div id="terrama2-filter" class="terrama2-leftbox">
          <div class="terrama2-leftbox-content">
            <div class="terrama2-leftbox-header"><h2>Filtro</h2></div>
            <div class="terrama2-form-group">
              <h4>Temporal</h4>
              <input type="text" class="terrama2-input terrama2-date terrama2-regular" id="terrama2-filter-date-de" placeholder="De"/>
              <input type="text" class="terrama2-input terrama2-date terrama2-regular" id="terrama2-filter-date-ate" placeholder="At&eacute;"/>
              <h4>Por Sat&eacute;lite</h4>
              <select class="terrama2-input terrama2-select" id="terrama2-filter-satellite"></select>
              <button class="terrama2-form-button" id="terrama2-filter-button">Aplicar</button>
            </div>
          </div>
        </div>
        <div id="terrama2-table" class="terrama2-leftbox terrama2-leftbox-fullscreen">
          <div class="terrama2-table-container">
            <div class="terrama2-leftbox-header"><h2>Tabelas</h2></div>
            <table class="display terrama2-table" id="table"></table>
          </div>
        </div>
        <div id="terrama2-graph" class="terrama2-leftbox terrama2-leftbox-fullscreen">
          <div class="terrama2-table-container">
            <div class="terrama2-leftbox-header"><h2>Gr&aacute;ficos</h2></div>
            <canvas id="canvas" style="/*max-width: calc(100% - 70px); max-height: calc(100% - 70px);*/"></canvas>
          </div>
        </div>
        <div id="terrama2-map"></div>
      </div>
    </div>
    <div class="footer">
      <div class="footer-text">
        Financiadores:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The World Bank&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Department for Environment, Food and Rural Affairs of United Kingdom (DEFRA)
        <br/>Projeto:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Platform of Monitoring and Warning of Forest Fires in the Brazilian Cerrado Project
      </div>
    </div>
    <script src="http://localhost/terrama2/webapp/public/js/terrama2.js" type="text/javascript"></script>
    <script>
    $("#gov-identity-bar").load('templates/barra-identidade-gov.html');
    var terrama2 = new TerraMA2([
      "MapDisplay",
      "LayerExplorer",
      "LeftBar",
      "Filter"
    ]);

    var filterConfig = terrama2.getConfig().getConfJsonFilter();
    var serverConfig = terrama2.getConfig().getConfJsonServer();

    var elem = "";
    var features = {};
    var featureDescription = {};

    var ignore = ['the_geom', 'Id'];

    var strInArr = function(arr, str) {
      for(i = 0, j = arr.length; i < j; i++) {
        if(arr[i] === str) {
          return true;
        }
      }
      return false;
    }

    $.ajax({
      url: serverConfig.ProxyURL,
      dataType: 'json',
      async: true,
      data: {
        url: serverConfig.URL,
        params: serverConfig.DescribeFeatureTypeParams + filterConfig.LayerToFilter
      },
      success: function(data) {

        featureDescription = data;

        var featuresDescriptionLength = featureDescription.featureTypes[0].properties.length;
        var titles = "";

        for(var i = 0; i < featuresDescriptionLength; i++) {
          if(!strInArr(ignore, featureDescription.featureTypes[0].properties[i].name)) {
            titles += "<th>" + featureDescription.featureTypes[0].properties[i].name + "</th>";
          }
        }

        $.ajax({
          url: serverConfig.ProxyURL,
          dataType: 'json',
          async: true,
          data: {
            url: serverConfig.URL,
            params: serverConfig.GetFeatureParams + filterConfig.LayerToFilter
          },
          success: function(data) {

            features = data;

            var items = "";

            //for(var i = 0; i < features.totalFeatures; i++) {
            for(var i = 0; i < 1000; i++) {
              items += "<tr>";
              for(var j = 0; j < featuresDescriptionLength; j++) {
                if(!strInArr(ignore, featureDescription.featureTypes[0].properties[j].name)) {
                  items += "<td>" + features.features[i].properties[featureDescription.featureTypes[0].properties[j].name] + "</td>";
                }
              }
              items += "</tr>";
            }

            $("#table").empty().append("<thead>" + titles + "</thead><tfoot>" + titles + "</tfoot><tbody>" + items + "</tbody>");

            $('.terrama2-table').DataTable();
          }
        });
      }
    });

    var barChartData = {
      labels : ["January","February","March","April","May","June","July"],
      datasets : [
        {
          fillColor : "rgba(220,220,220,0.5)",
          strokeColor : "rgba(220,220,220,0.8)",
          highlightFill: "rgba(220,220,220,0.75)",
          highlightStroke: "rgba(220,220,220,1)",
          data : [1,2,3,4,5,6,7]
        },
        {
          fillColor : "rgba(151,187,205,0.5)",
          strokeColor : "rgba(151,187,205,0.8)",
          highlightFill : "rgba(151,187,205,0.75)",
          highlightStroke : "rgba(151,187,205,1)",
          data : [7,6,5,4,3,2,1]
        }
      ]

    }

    var ctx = document.getElementById("canvas").getContext("2d");
    window.myBar = new Chart(ctx).Bar(barChartData, {
      responsive : true
    });
    </script>
  </body>
</html>
