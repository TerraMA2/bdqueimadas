!function(e,t){"function"==typeof define&&define.amd?define([],t):e.TerraMA2WebComponents=t()}(this,function(){var e,t,r;if(function(n){function o(e,t){return x.call(e,t)}function i(e,t){var r,n,o,i,a,l,s,u,c,d,p,f,m=t&&t.split("/"),y=h.map,g=y&&y["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&L.test(e[a])&&(e[a]=e[a].replace(L,"")),"."===e[0].charAt(0)&&m&&(f=m.slice(0,m.length-1),e=f.concat(e)),c=0;c<e.length;c++)if(p=e[c],"."===p)e.splice(c,1),c-=1;else if(".."===p){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((m||g)&&y){for(r=e.split("/"),c=r.length;c>0;c-=1){if(n=r.slice(0,c).join("/"),m)for(d=m.length;d>0;d-=1)if(o=y[m.slice(0,d).join("/")],o&&(o=o[n])){i=o,l=c;break}if(i)break;!s&&g&&g[n]&&(s=g[n],u=c)}!i&&s&&(i=s,l=u),i&&(r.splice(0,l,i),e=r.join("/"))}return e}function a(e,t){return function(){var r=C.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),f.apply(n,r.concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function s(e){return function(t){g[e]=t}}function u(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,p.apply(n,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function c(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function d(e){return function(){return h&&h.config&&h.config[e]||{}}}var p,f,m,y,g={},v={},h={},b={},x=Object.prototype.hasOwnProperty,C=[].slice,L=/\.js$/;m=function(e,t){var r,n=c(e),o=n[0];return e=n[1],o&&(o=i(o,t),r=u(o)),o?e=r&&r.normalize?r.normalize(e,l(t)):i(e,t):(e=i(e,t),n=c(e),o=n[0],e=n[1],o&&(r=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:r}},y={require:function(e){return a(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:d(e)}}},p=function(e,t,r,i){var l,c,d,p,f,h,x=[],C=typeof r;if(i=i||e,"undefined"===C||"function"===C){for(t=!t.length&&r.length?["require","exports","module"]:t,f=0;f<t.length;f+=1)if(p=m(t[f],i),c=p.f,"require"===c)x[f]=y.require(e);else if("exports"===c)x[f]=y.exports(e),h=!0;else if("module"===c)l=x[f]=y.module(e);else if(o(g,c)||o(v,c)||o(b,c))x[f]=u(c);else{if(!p.p)throw new Error(e+" missing "+c);p.p.load(p.n,a(i,!0),s(c),{}),x[f]=g[c]}d=r?r.apply(g[e],x):void 0,e&&(l&&l.exports!==n&&l.exports!==g[e]?g[e]=l.exports:d===n&&h||(g[e]=d))}else e&&(g[e]=r)},e=t=f=function(e,t,r,o,i){if("string"==typeof e)return y[e]?y[e](t):u(m(e,t).f);if(!e.splice){if(h=e,h.deps&&f(h.deps,h.callback),!t)return;t.splice?(e=t,t=r,r=null):e=n}return t=t||function(){},"function"==typeof r&&(r=o,o=i),o?p(n,e,t,r):setTimeout(function(){p(n,e,t,r)},4),f},f.config=function(e){return f(e)},e._defined=g,r=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,r])},r.amd={jQuery:!0}}(),r("externals/almond",function(){}),"undefined"==typeof jQuery)throw new Error("TerraMA2WebComponents requires jQuery");if("undefined"==typeof ol)throw new Error("TerraMA2WebComponents requires Openlayers 3");return r("TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents","TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents"],function(e,t){return{MapDisplay:e,LayerExplorer:t}}),r("TerraMA2WebComponentsPath/TerraMA2WebComponents",function(){}),r("TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents",[],function(){var e=null,t=null,r=null,n=new ol.Map({renderer:"canvas",target:"terrama2-map",view:new ol.View({projection:"EPSG:4326",center:[-55,-15],zoom:3})}),o=null,i=null,a=null,l=null,s=null,u=function(){return n},c=function(){var e=window.setInterval(function(){n.updateSize()},100);window.setTimeout(function(){clearInterval(e)},2e3)},d=function(e,t){var r=Q(n.getLayerGroup(),"id",e);r.getSource().updateParams(t)},p=function(e){var t=parseFloat(e),r=parseFloat(e);if(r>180||-180>=r){e=0>r?-1*e:parseFloat(e);var n=0;n=r/180%2===-0?e/180:r/180%2===-1?e/180+1:e/180%1===0?e/180-1:parseInt(e/180)%2===0?parseInt(e/180):Math.ceil(e/180),n>0&&(t=0>r?r+180*n:r-180*n)}return t},f=function(){var e=!1;if(n.getControls().forEach(function(t,r){return t instanceof ol.control.MousePosition?void(e=!0):void 0}),!e){$("#terrama2-map").append('<div id="terrama2-map-info"></div>');var t=new ol.control.MousePosition({coordinateFormat:function(e){return function(t){return ol.coordinate.toStringXY([p(t[0]),t[1]],e)}}(6),projection:"EPSG:4326",className:"terrama2-mouse-position",target:document.getElementById("terrama2-map-info")});n.addControl(t)}},m=function(){$("#terrama2-map-info").remove(),n.getControls().forEach(function(e,t){return e instanceof ol.control.MousePosition?void n.removeControl(e):void 0})},y=function(){var e=!1;n.getControls().forEach(function(t,r){return t instanceof ol.control.ScaleLine?void(e=!0):void 0}),e||n.addControl(new ol.control.ScaleLine)},g=function(){n.getControls().forEach(function(e,t){return e instanceof ol.control.ScaleLine?void n.removeControl(e):void 0})},v=function(){var e=!1;n.getInteractions().forEach(function(t,r){return t instanceof ol.interaction.DoubleClickZoom?void(e=!0):void 0}),e||n.addInteraction(new ol.interaction.DoubleClickZoom)},h=function(){n.getInteractions().forEach(function(e,t){return e instanceof ol.interaction.DoubleClickZoom?void n.removeInteraction(e):void 0})},b=function(e,t){var r=new ol.layer.Group({id:e,name:t});return r},x=function(e,t){var r=Q(n.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==r;if(o){var i=r.getLayers();i.push(b(e,t)),r.setLayers(i)}return o},C=function(e,t,r,n,o,i,a,l){var s={LAYERS:r,TILED:!0};null!==l&&void 0!==l&&""!==l&&(s.TIME=l);var u=new ol.layer.Tile({source:new ol.source.TileWMS({preload:1/0,url:e,serverType:t,params:s}),id:r,name:n,visible:o});return void 0!==i&&null!==i&&u.setMinResolution(i),void 0!==a&&null!==a&&u.setMaxResolution(a),u},L=function(e,t,r,o,i,a,l,s,u){var c=Q(n.getLayerGroup(),"id",s),d=null!==c;if(d){var p=c.getLayers();p.push(C(e,t,r,o,i,a,l,u)),c.setLayers(p)}return d},w=function(e,t,r,n,o,i,a,l,s){var u=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox}),style:function(e){var t=s(e,a,l);return T(t.fillColor,t.strokeColor)},id:t,name:r,visible:n});return void 0!==o&&null!==o&&u.setMinResolution(o),void 0!==i&&null!==i&&u.setMaxResolution(i),u},M=function(e,t,r,o,i,a,l,s,u,c){var d=Q(n.getLayerGroup(),"id",c),p=null!==d;if(p){var f=d.getLayers();f.push(w(e,t,r,o,i,a,l,s,u)),d.setLayers(f)}return p},E=function(e,t){var r=Q(n.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==r;if(o){var i=r.getLayers();i.push(new ol.layer.Group({layers:[new ol.layer.Tile({source:new ol.source.OSM,id:"osm",name:"Open Street Map",visible:!1}),new ol.layer.Tile({source:new ol.source.MapQuest({layer:"osm"}),id:"mapquest_osm",name:"MapQuest OSM",visible:!1}),new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"}),id:"mapquest_sat",name:"MapQuest Sat&eacute;lite",visible:!0})],id:e,name:t})),r.setLayers(i)}return o},S=function(e,t,r,n,o,i){s=i,l.emit("proxyRequest",{url:e,additionalParameters:{serverUrl:t,serverType:r,serverId:n,serverName:o}})},T=function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({color:t,width:2})})},V=function(e){if(e.setVisible(!e.getVisible()),e.getLayers)for(var t=e.getLayers().getArray(),r=t.length,n=0;r>n;n++)t[n].setVisible(e.getVisible());$(document).trigger("layerVisibilityChange",[e.get("id")])},A=function(e,t){var r=Q(n.getLayerGroup(),"id",e);if(r.setVisible(t),r.getLayers)for(var o=r.getLayers().getArray(),i=o.length,a=0;i>a;a++)o[a].setVisible(t);$(document).trigger("layerVisibilityChange",[e])},k=function(e){var t=Q(n.getLayerGroup(),"id",e);return t.get("visible")},G=function(e){$(document).unbind("layerVisibilityChange"),$(document).on("layerVisibilityChange",function(t,r){e(r)})},I=function(){n.addInteraction(e)},W=function(){n.removeInteraction(e)},P=function(){var t=e.getGeometry().getExtent();return t},D=function(t){e.on("boxstart",function(e){t()})},B=function(t){e.on("boxend",function(e){t()})},R=function(){var e=n.getView().calculateExtent(n.getSize());return e},_=function(){n.getView().fit(t,n.getSize(),{constrainResolution:!1})},j=function(e){n.getView().fit(e,n.getSize(),{constrainResolution:!1})},z=function(){return n.getView().getResolution()},O=function(e){var t=Q(n.getLayerGroup(),"id",e),r=z();return null!==t&&t.getMaxResolution()>=r&&t.getMinResolution()<=r},Z=function(e){null!==o&&n.getView().unByKey(o),o=n.getView().on("propertychange",function(t){switch(t.key){case"resolution":e()}})},q=function(e){null!==i&&n.getView().unByKey(i),i=n.on("dblclick",function(t){e(p(t.coordinate[0]),t.coordinate[1])})},F=function(e){null!==a&&n.getView().unByKey(a),a=n.on("click",function(t){e(p(t.coordinate[0]),t.coordinate[1])})},N=function(){null!==a&&n.getView().unByKey(a)},Q=function(e,t,r){if(e.get(t)===r)return e;if(e.getLayers)for(var n,o=e.getLayers().getArray(),i=o.length,a=0;i>a;a++)if(n=Q(o[a],t,r))return n;return null},K=function(e,t){Q(n.getLayerGroup(),"id",t).getSource().updateParams({CQL_FILTER:e})},J=function(e,t,r){var o=Q(n.getLayerGroup(),"id",e).getLayers(),i=o.removeAt(t);o.insertAt(r,i)},Y=function(){r=new ol.format.WMSCapabilities,n.getLayerGroup().set("id","terrama2-layerexplorer"),n.getLayerGroup().set("name","terrama2-layerexplorer"),e=new ol.interaction.DragBox({condition:ol.events.condition.always}),t=n.getView().calculateExtent(n.getSize()),$(document).ready(function(){c()})};return{getMap:u,updateMapSize:c,updateLayerSourceParams:d,addMousePosition:f,removeMousePosition:m,addScale:y,removeScale:g,enableDoubleClickZoom:v,disableDoubleClickZoom:h,addLayerGroup:x,createTileWMS:C,addTileWMSLayer:L,addGeoJSONVectorLayer:M,addBaseLayers:E,addCapabilitiesLayers:S,setLayerVisibility:V,setLayerVisibilityById:A,isLayerVisible:k,setLayerVisibilityChangeEvent:G,addZoomDragBox:I,removeZoomDragBox:W,getZoomDragBoxExtent:P,setZoomDragBoxStartEvent:D,setZoomDragBoxEndEvent:B,getCurrentExtent:R,zoomToInitialExtent:_,zoomToExtent:j,getCurrentResolution:z,isCurrentResolutionValidForLayer:O,setMapResolutionChangeEvent:Z,setMapDoubleClickEvent:q,setMapSingleClickEvent:F,unsetMapSingleClickEvent:N,findBy:Q,applyCQLFilter:K,alterLayerIndex:J,init:Y}}),r("TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents"],function(e){var t=null,r=null,n=null,o=function(){return t},i=function(e,t,r,n){return"<li data-layerid='"+e+"' data-parentid='"+r+"' id='"+e.replace(":","")+"' class='parent_li'><span class='group-name'><div class='terrama2-layerexplorer-plus'>+</div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+t+"</span><ul class='children'>"+n+"</ul></li>"},a=function(e,t,r,n){var o=n?"<input type='checkbox' class='terrama2-layerexplorer-checkbox' checked/>":"<input type='checkbox' class='terrama2-layerexplorer-checkbox'/>";return"<li data-layerid='"+e+"' data-parentid='"+r+"' id='"+e.replace(":","")+"' class='layer'>"+o+"<span class='terrama2-layerexplorer-checkbox-span'>"+t+"</span></li>"},l=function(e,t){var o=r.findBy(n.getLayerGroup(),"id",e);if(null!==o){var i=s(o,t);"terrama2-layerexplorer"===t?$("#"+t).prepend(i):$("#"+t+" > ul.children").prepend(i),$("input.opacity").slider(),$(".parent_li").find(" > ul > li").hide(),c()}},s=function(e,t){var r="";if(e.getLayers){for(var n="",o=e.getLayers().getArray(),l=o.length,u=0;l>u;u++){var c=n;n=s(o[u],e.get("id"))+c}$("#"+e.get("id").replace(":","")).length||(r=i(e.get("id"),e.get("name"),t,n))}else $("#"+e.get("id").replace(":","")).length||(r=a(e.get("id"),e.get("name"),t,e.get("visible")));return r},u=function(){$("#terrama2-layerexplorer").on("click","span.group-name",function(e){var t=$(this).parent("li.parent_li").find(" > ul > li");t.is(":visible")?(t.hide("fast"),$(this).find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+"),$(this).parent("li.parent_li").removeClass("open")):(t.show("fast"),$(this).find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"),$(this).parent("li.parent_li").addClass("open"))}),$("input.opacity").on("slide",function(e){var t=$(this).closest("li").data("layerid"),o=r.findBy(n.getLayerGroup(),"id",t);o.setOpacity(e.value)}),$("#terrama2-layerexplorer").on("click","input.terrama2-layerexplorer-checkbox",function(e){var t=$(this).closest("li").data("layerid"),o=r.findBy(n.getLayerGroup(),"id",t);if(null!==o){r.setLayerVisibility(o);var i=$(this).parent("li.parent_li").find(" > ul > li"),a=$(this).parent("li.parent_li").find(" > span");i.is(":visible")||!o.getVisible()?(i.hide("fast"),a.find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+")):(i.show("fast"),a.find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"))}e.stopPropagation()}),$("#terrama2-layerexplorer").on("click","li.layer",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t=null):($("li.parent_li ul li").removeClass("selected"),$(this).addClass("selected"),t=$(this).attr("data-layerid"))})},c=function(){$(".children").sortable({start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,r){e.alterLayerIndex(r.item.attr("data-parentid"),$(this).attr("data-previndex"),r.item.context.parentNode.childElementCount-1-r.item.index()),$(this).removeAttr("data-previndex")}}),$(".children").disableSelection(),$("#terrama2-layerexplorer").sortable({start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,r){e.alterLayerIndex(r.item.attr("data-parentid"),$(this).attr("data-previndex"),r.item.context.parentNode.childElementCount-1-r.item.index()),$(this).removeAttr("data-previndex")}}),$("#terrama2-layerexplorer").disableSelection()},d=function(){r=e,n=r.getMap(),u()};return{getSelectedLayer:o,addLayersFromMap:l,init:d}}),t("TerraMA2WebComponents")});