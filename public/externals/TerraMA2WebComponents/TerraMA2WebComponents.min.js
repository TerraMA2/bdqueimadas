/*! TerraMA2WebComponents 4.0.0-alpha4 | (C) 2007, 2016 National Institute For Space Research (INPE) - Brazil | https://github.com/TerraMA2/terrama2/blob/master/LICENSE */
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.TerraMA2WebComponents=t()}(this,function(){var e,t,n;if(function(r){function o(e,t){return b.call(e,t)}function i(e,t){var n,r,o,i,a,l,u,s,c,d,f,p,y=t&&t.split("/"),m=h.map,v=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&C.test(e[a])&&(e[a]=e[a].replace(C,"")),"."===e[0].charAt(0)&&y&&(p=y.slice(0,y.length-1),e=p.concat(e)),c=0;c<e.length;c++)if(f=e[c],"."===f)e.splice(c,1),c-=1;else if(".."===f){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((y||v)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),y)for(d=y.length;d>0;d-=1)if(o=m[y.slice(0,d).join("/")],o&&(o=o[r])){i=o,l=c;break}if(i)break;!u&&v&&v[r]&&(u=v[r],s=c)}!i&&u&&(i=u,l=s),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(r,n.concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function u(e){return function(t){v[e]=t}}function s(e){if(o(g,e)){var t=g[e];delete g[e],L[e]=!0,f.apply(r,t)}if(!o(v,e)&&!o(L,e))throw new Error("No "+e);return v[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return h&&h.config&&h.config[e]||{}}}var f,p,y,m,v={},g={},h={},L={},b=Object.prototype.hasOwnProperty,x=[].slice,C=/\.js$/;y=function(e,t){var n,r=c(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=s(o)),o?e=n&&n.normalize?n.normalize(e,l(t)):i(e,t):(e=i(e,t),r=c(e),o=r[0],e=r[1],o&&(n=s(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return a(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},f=function(e,t,n,i){var l,c,d,f,p,h,b=[],x=typeof n;if(i=i||e,"undefined"===x||"function"===x){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(f=y(t[p],i),c=f.f,"require"===c)b[p]=m.require(e);else if("exports"===c)b[p]=m.exports(e),h=!0;else if("module"===c)l=b[p]=m.module(e);else if(o(v,c)||o(g,c)||o(L,c))b[p]=s(c);else{if(!f.p)throw new Error(e+" missing "+c);f.p.load(f.n,a(i,!0),u(c),{}),b[p]=v[c]}d=n?n.apply(v[e],b):void 0,e&&(l&&l.exports!==r&&l.exports!==v[e]?v[e]=l.exports:d===r&&h||(v[e]=d))}else e&&(v[e]=n)},e=t=p=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):s(y(e,t).f);if(!e.splice){if(h=e,h.deps&&p(h.deps,h.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),p},p.config=function(e){return p(e)},e._defined=v,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(v,e)||o(g,e)||(g[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("externals/almond",function(){}),"undefined"==typeof jQuery)throw new Error("TerraMA2WebComponents requires jQuery");if("undefined"==typeof ol)throw new Error("TerraMA2WebComponents requires Openlayers 3");return n("TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents","TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents"],function(e,t){return{MapDisplay:e,LayerExplorer:t}}),n("TerraMA2WebComponentsPath/TerraMA2WebComponents",function(){}),n("TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents",[],function(){var e=null,t=null,n=null,r=new ol.Map({renderer:["canvas","dom"],target:"terrama2-map",view:new ol.View({center:[-55,-15],zoom:3,maxResolution:.5625,extent:[-180,-90,180,90],projection:ol.proj.get("EPSG:4326")})}),o=null,i=null,a=null,l=null,u=null,s={},c={},d=function(){return r},f=function(){var e=window.setInterval(function(){r.updateSize()},100);window.setTimeout(function(){clearInterval(e)},2e3)},p=function(e,t,n){var o=se(r.getLayerGroup(),"id",e);o.getSource().updateParams(t),n&&o.getSource().refresh()},y=function(e,t,n){if(void 0!==n&&null!==n){var o=se(r.getLayerGroup(),"id",e);o.setSource(G(n.url,e,t,n.format,n.matrixSet,n.tileGrid))}else p(e,{TIME:t},!0)},m=function(e,t,n){var o=se(r.getLayerGroup(),"id",e);o.set(t,n,!1)},v=function(e){var t=parseFloat(e),n=parseFloat(e);if(n>180||-180>=n){e=0>n?-1*e:parseFloat(e);var r=0;r=n/180%2===-0?e/180:n/180%2===-1?e/180+1:e/180%1===0?e/180-1:parseInt(e/180)%2===0?parseInt(e/180):Math.ceil(e/180),r>0&&(t=0>n?n+180*r:n-180*r)}return t},g=function(e,t){var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60),i=o;o=Math.floor(o);var a=(i-o)/(1/60);a=Math.round(10*a),a/=10,10>r&&(r="0"+r),10>o&&(o="0"+o),10>a&&(a="0"+a);var l=r+" "+o+" "+a+" "+h(e,t);return l},h=function(e,t){var n="";return"LAT"==t?n=e>=0?"N":"S":"LON"==t&&(n=e>=0?"E":"W"),n},L=function(){var e=!1;if(r.getControls().forEach(function(t,n){return t instanceof ol.control.MousePosition?void(e=!0):void 0}),!e){$("#terrama2-map").append('<div id="terrama2-map-info"></div>');var t=new ol.control.MousePosition({coordinateFormat:function(e){return function(t){return ol.coordinate.toStringXY([v(t[0]),t[1]],e)+"<br/>"+g(v(t[0]),"LON")+", "+g(t[1],"LAT")}}(6),projection:"EPSG:4326",className:"terrama2-mouse-position",target:document.getElementById("terrama2-map-info")});r.addControl(t)}},b=function(){$("#terrama2-map-info").remove(),r.getControls().forEach(function(e,t){return e instanceof ol.control.MousePosition?void r.removeControl(e):void 0})},x=function(){var e=!1;r.getControls().forEach(function(t,n){return t instanceof ol.control.ScaleLine?void(e=!0):void 0}),e||r.addControl(new ol.control.ScaleLine)},C=function(){r.getControls().forEach(function(e,t){return e instanceof ol.control.ScaleLine?void r.removeControl(e):void 0})},M=function(){var e=!1;r.getInteractions().forEach(function(t,n){return t instanceof ol.interaction.DoubleClickZoom?void(e=!0):void 0}),e||r.addInteraction(new ol.interaction.DoubleClickZoom)},w=function(){r.getInteractions().forEach(function(e,t){return e instanceof ol.interaction.DoubleClickZoom?void r.removeInteraction(e):void 0})},E=function(e,t){var n=new ol.layer.Group({id:e,name:t});return n},S=function(e,t){var n=se(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers();i.push(E(e,t)),n.setLayers(i)}return o},T=function(e,t,n,r,o,i,a,s,c,d,f,p,y,m){var v={LAYERS:n,TILED:!0};null!==c&&void 0!==c&&""!==c&&(v.TIME=c),null!==f&&void 0!==f&&""!==f&&(v.BUFFER=f),null!==p&&void 0!==p&&""!==p&&(v.VERSION=p),null!==y&&void 0!==y&&""!==y&&(v.FORMAT=y);var g={url:e,serverType:t,params:v};null!==m&&void 0!==m&&""!==m&&(g.tileGrid=new ol.tilegrid.TileGrid(m));var h=new ol.source.TileWMS(g);null!==l&&null!==u&&(h.on("tileloadstart",function(){F(n)}),h.on("tileloadend",function(){P(n)}),h.on("tileloaderror",function(){P(n)}));var L=new ol.layer.Tile({source:h,id:n,name:r,title:o,visible:i,disabled:d});return void 0!==a&&null!==a&&L.setMinResolution(a),void 0!==s&&null!==s&&L.setMaxResolution(s),L},G=function(e,t,n,r,o,i){e=null!==n&&void 0!==n&&""!==n?e+"?TIME="+n:e;var a={url:e,layer:t,format:r,matrixSet:o,tileGrid:new ol.tilegrid.WMTS(i)},s=new ol.source.WMTS(a);return null!==l&&null!==u&&(s.on("tileloadstart",function(){F(t)}),s.on("tileloadend",function(){P(t)}),s.on("tileloaderror",function(){P(t)})),s},A=function(e,t,n,r,o,i,a,l,u,s,c,d){var f=new ol.layer.Tile({source:G(e,t,l,s,c,d),id:t,name:n,title:r,visible:o,disabled:u});return void 0!==i&&null!==i&&f.setMinResolution(i),void 0!==a&&null!==a&&f.setMaxResolution(a),f},V=function(e,t,n,o,i,a,l,u,s,c,d,f,p,y,m){var v=se(r.getLayerGroup(),"id",s),g=null!==v;if(g){var h=v.getLayers();h.push(T(e,t,n,o,i,a,l,u,c,d,f,p,y,m)),v.setLayers(h)}return g},k=function(e,t,n,o,i,a,l,u,s,c,d,f,p){var y=se(r.getLayerGroup(),"id",u),m=null!==y;if(m){var v=y.getLayers();v.push(A(e,t,n,o,i,a,l,s,c,d,f,p)),y.setLayers(v)}return m},I=function(e,t,n,r,o,i,a,l,u,s){var c=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox}),style:function(e){var t=s(e,l,u);return N(t.fillColor,t.strokeColor)},id:t,name:n,title:r,visible:o});return void 0!==i&&null!==i&&c.setMinResolution(i),void 0!==a&&null!==a&&c.setMaxResolution(a),c},W=function(e,t,n,o,i,a,l,u,s,c,d){var f=se(r.getLayerGroup(),"id",d),p=null!==f;if(p){var y=f.getLayers();y.push(I(e,t,n,o,i,a,l,u,s,c)),f.setLayers(y)}return p},R=function(e,t){if("undefined"!==t&&"undefined"!==t&&void 0!==t&&null!==t){var n=se(r.getLayerGroup(),"id",t),o=n.getLayers();o.forEach(function(t,n,r){return e===t.get("id")?(o.remove(t),!1):void 0}),n.setLayers(o)}else{var i=se(r.getLayerGroup(),"id",e);r.removeLayer(i)}},F=function(e){void 0===s[e]&&(s[e]=0),0===s[e]&&l(),++s[e]},P=function(e){void 0===s[e]&&(s[e]=0),void 0===c[e]&&(c[e]=0),setTimeout(function(){++c[e],s[e]===c[e]&&(s[e]=0,c[e]=0,u())},500)},D=function(e,t,n,o,i,a){a=null!==a&&void 0!==a?a:!1;var s=se(r.getLayerGroup(),"id",i),c=null!==s;if(c){var d=s.getLayers(),f=new ol.source.OSM;null!==l&&null!==u&&(f.on("tileloadstart",function(){F(e)}),f.on("tileloadend",function(){P(e)}),f.on("tileloaderror",function(){P(e)}));var p=new ol.layer.Tile({source:f,id:e,name:t,title:n,visible:o});a?d.insertAt(0,p):d.push(p),s.setLayers(d)}return c},B=function(e,t,n,o,i,a){a=null!==a&&void 0!==a?a:!1;var s=se(r.getLayerGroup(),"id",i),c=null!==s;if(c){var d=s.getLayers(),f=new ol.source.MapQuest({layer:"sat"});null!==l&&null!==u&&(f.on("tileloadstart",function(){F(e)}),f.on("tileloadend",function(){P(e)}),f.on("tileloaderror",function(){P(e)}));var p=new ol.layer.Tile({source:f,id:e,name:t,title:n,visible:o});a?d.insertAt(0,p):d.push(p),s.setLayers(d)}return c},O=function(e){l=e},j=function(e){u=e},N=function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({color:t,width:2})})},z=function(e){if(e.setVisible(!e.getVisible()),e.getLayers)for(var t=e.getLayers().getArray(),n=t.length,r=0;n>r;r++)t[r].setVisible(e.getVisible());$(document).trigger("layerVisibilityChange",[e.get("id")])},_=function(e,t){var n=se(r.getLayerGroup(),"id",e);if(n.setVisible(t),n.getLayers)for(var o=n.getLayers().getArray(),i=o.length,a=0;i>a;a++)o[a].setVisible(t);$(document).trigger("layerVisibilityChange",[e])},Z=function(e){var t=se(r.getLayerGroup(),"id",e);return t.get("visible")},Q=function(e){$(document).unbind("layerVisibilityChange"),$(document).on("layerVisibilityChange",function(t,n){e(n)})},q=function(){r.addInteraction(e)},K=function(){r.removeInteraction(e)},U=function(){var t=e.getGeometry().getExtent();return t},J=function(t){e.on("boxstart",function(e){t()})},Y=function(t){e.on("boxend",function(e){t()})},X=function(){var e=r.getView().calculateExtent(r.getSize());return e},H=function(){r.getView().fit(t,r.getSize(),{constrainResolution:!1})},ee=function(e){r.getView().fit(e,r.getSize(),{constrainResolution:!1})},te=function(){return r.getView().getResolution()},ne=function(e){var t=se(r.getLayerGroup(),"id",e),n=te();return null!==t&&t.getMaxResolution()>=n&&t.getMinResolution()<=n},re=function(e){null!==o&&r.getView().unByKey(o),o=r.getView().on("propertychange",function(t){switch(t.key){case"resolution":e()}})},oe=function(e){null!==i&&r.getView().unByKey(i),i=r.on("dblclick",function(t){e(v(t.coordinate[0]),t.coordinate[1])})},ie=function(e){null!==a&&r.getView().unByKey(a),a=r.on("click",function(t){e(v(t.coordinate[0]),t.coordinate[1])})},ae=function(){null!==a&&r.getView().unByKey(a)},le=function(e,t){ae(),ie(function(n,o){var i=se(r.getLayerGroup(),"id",e).getSource(),a=[n,o],l=r.getView().getResolution(),u="EPSG:4326",s={INFO_FORMAT:"application/json"},c=i.getGetFeatureInfoUrl(a,l,u,s);t(c?c:null)})},ue=function(){ae()},se=function(e,t,n){if(e.get(t)===n)return e;if(e.getLayers)for(var r,o=e.getLayers().getArray(),i=o.length,a=0;i>a;a++)if(r=se(o[a],t,n))return r;return null},ce=function(e,t){se(r.getLayerGroup(),"id",t).getSource().updateParams({CQL_FILTER:e})},de=function(e,t,n){var o=se(r.getLayerGroup(),"id",e).getLayers(),i=o.removeAt(t);o.insertAt(n,i)},fe=function(){n=new ol.format.WMSCapabilities,r.getLayerGroup().set("id","terrama2-layerexplorer"),r.getLayerGroup().set("name","terrama2-layerexplorer"),e=new ol.interaction.DragBox({condition:ol.events.condition.always}),t=r.getView().calculateExtent(r.getSize()),$(".ol-attribution > button > span").html("Â©"),$(document).ready(function(){f()})};return{getMap:d,updateMapSize:f,updateLayerSourceParams:p,updateLayerAttribute:m,addMousePosition:L,removeMousePosition:b,addScale:x,removeScale:C,enableDoubleClickZoom:M,disableDoubleClickZoom:w,addLayerGroup:S,updateLayerTime:y,addTileWMSLayer:V,addWMTSLayer:k,addGeoJSONVectorLayer:W,removeLayer:R,addOSMLayer:D,addMapQuestSatelliteLayer:B,setLayersStartLoadingFunction:O,setLayersEndLoadingFunction:j,setLayerVisibility:z,setLayerVisibilityById:_,isLayerVisible:Z,setLayerVisibilityChangeEvent:Q,addZoomDragBox:q,removeZoomDragBox:K,getZoomDragBoxExtent:U,setZoomDragBoxStartEvent:J,setZoomDragBoxEndEvent:Y,getCurrentExtent:X,zoomToInitialExtent:H,zoomToExtent:ee,getCurrentResolution:te,isCurrentResolutionValidForLayer:ne,setMapResolutionChangeEvent:re,setMapDoubleClickEvent:oe,setMapSingleClickEvent:ie,unsetMapSingleClickEvent:ae,setGetFeatureInfoUrlOnClick:le,unsetGetFeatureInfoUrlOnClick:ue,findBy:se,applyCQLFilter:ce,alterLayerIndex:de,init:fe}}),n("TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents"],function(e){var t=null,n=null,r=null,o=function(){return t},i=function(e,t,n,r,o,i){return o=""!==o?" "+o:o,"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='parent_li"+o+"' style='"+i+"'><span class='group-name'><div class='terrama2-layerexplorer-plus'></div><span>"+t+"</span></span><ul class='children'>"+r+"</ul></li>"},a=function(e,t,n,r,o,i,a,l){var u=o?"<input type='checkbox' class='terrama2-layerexplorer-checkbox' checked/>":"<input type='checkbox' class='terrama2-layerexplorer-checkbox'/>";return a=""!==a?a+" ":a,a+=i?"layer disabled-content":"layer","<li data-layerid='"+e+"' data-parentid='"+r+"' title='"+n+"' id='"+e.replace(":","")+"' class='"+a+"' style='"+l+"'>"+u+"<span class='terrama2-layerexplorer-checkbox-span'>"+t+"</span></li>"},l=function(e,t,o,i,a){o=null!==o&&void 0!==o?o:!1,i=null!==i&&void 0!==i?i:"",a=null!==a&&void 0!==a?a:"";var l=n.findBy(r.getLayerGroup(),"id",e);if(null!==l){l.classes=i,l.style=a;var u=s(l,t);"terrama2-layerexplorer"===t?o?$("#"+t).append(u):$("#"+t).prepend(u):o?$("#"+t+" > ul.children").append(u):$("#"+t+" > ul.children").prepend(u),$("input.opacity").slider(),$(".parent_li").find(" > ul > li").hide(),d()}},u=function(e,t){$("#"+e.replace(":","")).remove(),n.removeLayer(e,t)},s=function(e,t){var n="";if(e.getLayers){for(var r="",o=e.getLayers().getArray(),l=o.length,u=0;l>u;u++){var c=r;r=s(o[u],e.get("id"))+c}$("#"+e.get("id").replace(":","")).length||(n=i(e.get("id"),e.get("name"),t,r,e.classes,e.style))}else $("#"+e.get("id").replace(":","")).length||(n=a(e.get("id"),e.get("name"),e.get("title"),t,e.get("visible"),e.get("disabled"),e.classes,e.style));return n},c=function(){$("#terrama2-layerexplorer").on("click","span.group-name",function(e){var t=$(this).parent("li.parent_li").find(" > ul > li");t.is(":visible")?(t.hide("fast"),$(this).find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus"),$(this).parent("li.parent_li").removeClass("open")):(t.show("fast"),$(this).find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus"),$(this).parent("li.parent_li").addClass("open"))}),$("input.opacity").on("slide",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);o.setOpacity(e.value)}),$("#terrama2-layerexplorer").on("click","input.terrama2-layerexplorer-checkbox",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);if(null!==o){n.setLayerVisibility(o);var i=$(this).parent("li.parent_li").find(" > ul > li"),a=$(this).parent("li.parent_li").find(" > span");i.is(":visible")||!o.getVisible()?(i.hide("fast"),a.find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus")):(i.show("fast"),a.find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus"))}e.stopPropagation()}),$("#terrama2-layerexplorer").on("click","li.layer",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t=null):($("li.parent_li ul li").removeClass("selected"),$(this).addClass("selected"),t=$(this).attr("data-layerid"))})},d=function(){$(".children").sortable({items:"li:not(.unsortable)",start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$(".children").disableSelection(),$("#terrama2-layerexplorer").sortable({items:"li:not(.unsortable)",start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$("#terrama2-layerexplorer").disableSelection()},f=function(){n=e,r=n.getMap(),c()};return{getSelectedLayer:o,addLayersFromMap:l,removeLayer:u,init:f}}),t("TerraMA2WebComponents")});