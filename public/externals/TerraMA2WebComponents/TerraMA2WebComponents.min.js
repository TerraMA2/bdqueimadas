/*! TerraMA2WebComponents 4.0.0-beta3 | (C) 2007, 2017 National Institute For Space Research (INPE) - Brazil | https://github.com/TerraMA2/terrama2/blob/master/LICENSE */
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.TerraMA2WebComponents=t()}(this,function(){var e,t,n;if(function(r){function o(e,t){return L.call(e,t)}function i(e,t){var n,r,o,i,a,l,u,s,c,d,f,p,m=t&&t.split("/"),y=h.map,v=y&&y["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&M.test(e[a])&&(e[a]=e[a].replace(M,"")),"."===e[0].charAt(0)&&m&&(p=m.slice(0,m.length-1),e=p.concat(e)),c=0;c<e.length;c++)if(f=e[c],"."===f)e.splice(c,1),c-=1;else if(".."===f){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((m||v)&&y){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),m)for(d=m.length;d>0;d-=1)if(o=y[m.slice(0,d).join("/")],o&&(o=o[r])){i=o,l=c;break}if(i)break;!u&&v&&v[r]&&(u=v[r],s=c)}!i&&u&&(i=u,l=s),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(r,n.concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function u(e){return function(t){v[e]=t}}function s(e){if(o(g,e)){var t=g[e];delete g[e],b[e]=!0,f.apply(r,t)}if(!o(v,e)&&!o(b,e))throw new Error("No "+e);return v[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return h&&h.config&&h.config[e]||{}}}var f,p,m,y,v={},g={},h={},b={},L=Object.prototype.hasOwnProperty,x=[].slice,M=/\.js$/;m=function(e,t){var n,r=c(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=s(o)),o?e=n&&n.normalize?n.normalize(e,l(t)):i(e,t):(e=i(e,t),r=c(e),o=r[0],e=r[1],o&&(n=s(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},y={require:function(e){return a(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},f=function(e,t,n,i){var l,c,d,f,p,h,L=[],x=typeof n;if(i=i||e,"undefined"===x||"function"===x){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(f=m(t[p],i),c=f.f,"require"===c)L[p]=y.require(e);else if("exports"===c)L[p]=y.exports(e),h=!0;else if("module"===c)l=L[p]=y.module(e);else if(o(v,c)||o(g,c)||o(b,c))L[p]=s(c);else{if(!f.p)throw new Error(e+" missing "+c);f.p.load(f.n,a(i,!0),u(c),{}),L[p]=v[c]}d=n?n.apply(v[e],L):void 0,e&&(l&&l.exports!==r&&l.exports!==v[e]?v[e]=l.exports:d===r&&h||(v[e]=d))}else e&&(v[e]=n)},e=t=p=function(e,t,n,o,i){if("string"==typeof e)return y[e]?y[e](t):s(m(e,t).f);if(!e.splice){if(h=e,h.deps&&p(h.deps,h.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),p},p.config=function(e){return p(e)},e._defined=v,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(v,e)||o(g,e)||(g[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("externals/almond",function(){}),"undefined"==typeof jQuery)throw new Error("TerraMA2WebComponents requires jQuery");if("undefined"==typeof ol)throw new Error("TerraMA2WebComponents requires Openlayers 3");return n("TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents","TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents"],function(e,t){return{MapDisplay:e,LayerExplorer:t}}),n("TerraMA2WebComponentsPath/TerraMA2WebComponents",function(){}),n("TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents",[],function(){var e=null,t=null,n=null,r=new ol.Map({renderer:["canvas","dom"],target:"terrama2-map",view:new ol.View({center:[-55,-15],zoom:3,maxResolution:.5625,extent:[-180,-90,180,90],projection:ol.proj.get("EPSG:4326")})}),o=null,i=null,a=null,l=null,u=null,s={},c={},d=function(){return r},f=function(){var e=window.setInterval(function(){r.updateSize()},100);window.setTimeout(function(){clearInterval(e)},2e3)},p=function(e,t,n){var o=fe(r.getLayerGroup(),"id",e);o.getSource().updateParams(t),n&&o.getSource().refresh()},m=function(e,t,n){if(void 0!==n&&null!==n){var o=fe(r.getLayerGroup(),"id",e);o.setSource(A(n.url,e,t,n.format,n.matrixSet,n.tileGrid))}else p(e,{TIME:t},!0)},y=function(e,t){var n=fe(r.getLayerGroup(),"id",e);n.setOpacity(t)},v=function(e){var t=fe(r.getLayerGroup(),"id",e);return t.getOpacity()},g=function(e,t,n){var o=fe(r.getLayerGroup(),"id",e);o.set(t,n,!1)},h=function(e){var t=parseFloat(e),n=parseFloat(e);if(n>180||-180>=n){e=0>n?-1*e:parseFloat(e);var r=0;r=n/180%2===-0?e/180:n/180%2===-1?e/180+1:e/180%1===0?e/180-1:parseInt(e/180)%2===0?parseInt(e/180):Math.ceil(e/180),r>0&&(t=0>n?n+180*r:n-180*r)}return t},b=function(e,t){var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60),i=o;o=Math.floor(o);var a=(i-o)/(1/60);a=Math.round(10*a),a/=10,10>r&&(r="0"+r),10>o&&(o="0"+o),10>a&&(a="0"+a);var l=r+" "+o+" "+a+" "+L(e,t);return l},L=function(e,t){var n="";return"LAT"==t?n=e>=0?"N":"S":"LON"==t&&(n=e>=0?"E":"W"),n},x=function(){var e=!1;if(r.getControls().forEach(function(t,n){return t instanceof ol.control.MousePosition?void(e=!0):void 0}),!e){$("#terrama2-map").append('<div id="terrama2-map-info"></div>');var t=new ol.control.MousePosition({coordinateFormat:function(e){return function(t){return ol.coordinate.toStringXY([h(t[0]),t[1]],e)+"<br/>"+b(h(t[0]),"LON")+", "+b(t[1],"LAT")}}(6),projection:"EPSG:4326",className:"terrama2-mouse-position",target:document.getElementById("terrama2-map-info")});r.addControl(t)}},M=function(){$("#terrama2-map-info").remove(),r.getControls().forEach(function(e,t){return e instanceof ol.control.MousePosition?void r.removeControl(e):void 0})},C=function(){var e=!1;r.getControls().forEach(function(t,n){return t instanceof ol.control.ScaleLine?void(e=!0):void 0}),e||r.addControl(new ol.control.ScaleLine)},w=function(){r.getControls().forEach(function(e,t){return e instanceof ol.control.ScaleLine?void r.removeControl(e):void 0})},E=function(){var e=!1;r.getInteractions().forEach(function(t,n){return t instanceof ol.interaction.DoubleClickZoom?void(e=!0):void 0}),e||r.addInteraction(new ol.interaction.DoubleClickZoom)},S=function(){r.getInteractions().forEach(function(e,t){return e instanceof ol.interaction.DoubleClickZoom?void r.removeInteraction(e):void 0})},G=function(e,t){var n=new ol.layer.Group({id:e,name:t});return n},R=function(e,t,n){var o=fe(r.getLayerGroup(),"id",n),i=null!==o;if(i){var a=o.getLayers();a.push(G(e,t)),o.setLayers(a)}return i},T=function(e,t,n,r,o,i,a,s){s=void 0!==s&&null!==s?s:{};var c=void 0!==s.sourceParams&&null!==s.sourceParams?s.sourceParams:{};c.LAYERS=e,c.TILED=!0,void 0!==s.time&&null!==s.time&&""!==s.time&&(c.TIME=s.time),void 0!==s.buffer&&null!==s.buffer&&""!==s.buffer&&(c.BUFFER=s.buffer),void 0!==s.version&&null!==s.version&&""!==s.version&&(c.VERSION=s.version),void 0!==s.format&&null!==s.format&&""!==s.format&&(c.FORMAT=s.format);var d={url:r,serverType:o,params:c};void 0!==s.tileGrid&&null!==s.tileGrid&&""!==s.tileGrid&&(d.tileGrid=new ol.tilegrid.TileGrid(s.tileGrid));var f=new ol.source.TileWMS(d);null!==l&&null!==u&&(f.on("tileloadstart",function(){D(e)}),f.on("tileloadend",function(){j(e)}),f.on("tileloaderror",function(){j(e)}));var p=new ol.layer.Tile({source:f,id:e,name:t,title:n,visible:i,preload:1/0,disabled:a});return void 0!==s.minResolution&&null!==s.minResolution&&p.setMinResolution(s.minResolution),void 0!==s.maxResolution&&null!==s.maxResolution&&p.setMaxResolution(s.maxResolution),p},A=function(e,t,n,r,o,i){e=void 0!==n&&null!==n&&""!==n?e+"?TIME="+n:e;var a={url:e,layer:t,format:r,matrixSet:o,tileGrid:new ol.tilegrid.WMTS(i)},s=new ol.source.WMTS(a);return null!==l&&null!==u&&(s.on("tileloadstart",function(){D(t)}),s.on("tileloadend",function(){j(t)}),s.on("tileloaderror",function(){j(t)})),s},V=function(e,t,n,r,o,i,a,l,u,s,c){var d=new ol.layer.Tile({source:A(r,e,a,l,u,s),id:e,name:t,title:n,visible:o,preload:1/0,disabled:i});return void 0!==c.minResolution&&null!==c.minResolution&&d.setMinResolution(c.minResolution),void 0!==c.maxResolution&&null!==c.maxResolution&&d.setMaxResolution(c.maxResolution),d},k=function(e,t,n,r,o,i,a,s){var c={key:a,imagerySet:i,maxZoom:19,culture:"pt-br"},d=new ol.source.BingMaps(c);null!==l&&null!==u&&(d.on("tileloadstart",function(){D(e)}),d.on("tileloadend",function(){j(e)}),d.on("tileloaderror",function(){j(e)}));var f=new ol.layer.Tile({source:d,id:e,name:t,title:n,visible:r,disabled:o});return void 0!==s.minResolution&&null!==s.minResolution&&f.setMinResolution(s.minResolution),void 0!==s.maxResolution&&null!==s.maxResolution&&f.setMaxResolution(s.maxResolution),f},I=function(e,t,n,o,i,a,l,u,s){var c=fe(r.getLayerGroup(),"id",u),d=null!==c;if(d){var f=c.getLayers();f.push(T(e,t,n,o,i,a,l,s)),c.setLayers(f)}return d},W=function(e,t,n,o,i,a,l,u,s,c,d,f){var p=fe(r.getLayerGroup(),"id",d),m=null!==p;if(m){var y=p.getLayers();y.push(V(e,t,n,o,i,a,l,u,s,c,f)),p.setLayers(y)}return m},P=function(e,t,n,o,i,a,l,u,s,c){var d=fe(r.getLayerGroup(),"id",u),f=null!==d;if(f){var p=d.getLayers(),m=k(e,t,n,o,i,a,l,c);s?p.insertAt(0,m):p.push(m),d.setLayers(p)}return f},O=function(e,t,n,r,o,i,a,l,u,s){var c=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox}),style:function(e){var t=s(e,l,u);return _(t.fillColor,t.strokeColor)},id:t,name:n,title:r,visible:o});return void 0!==i&&null!==i&&c.setMinResolution(i),void 0!==a&&null!==a&&c.setMaxResolution(a),c},B=function(e,t,n,o,i,a,l,u,s,c,d){var f=fe(r.getLayerGroup(),"id",d),p=null!==f;if(p){var m=f.getLayers();m.push(O(e,t,n,o,i,a,l,u,s,c)),f.setLayers(m)}return p},F=function(e,t){if("undefined"!==t&&"undefined"!==t&&void 0!==t&&null!==t){var n=fe(r.getLayerGroup(),"id",t),o=n.getLayers();o.forEach(function(t,n,r){return e===t.get("id")?(o.remove(t),!1):void 0}),n.setLayers(o)}else{var i=fe(r.getLayerGroup(),"id",e);r.removeLayer(i)}},D=function(e){void 0===s[e]&&(s[e]=0),0===s[e]&&l(),++s[e]},j=function(e){void 0===s[e]&&(s[e]=0),void 0===c[e]&&(c[e]=0),setTimeout(function(){++c[e],s[e]===c[e]&&(s[e]=0,c[e]=0,u())},500)},N=function(e,t,n,o,i,a){a=void 0!==a&&null!==a?a:!1;var s=fe(r.getLayerGroup(),"id",i),c=null!==s;if(c){var d=s.getLayers(),f=new ol.source.OSM;null!==l&&null!==u&&(f.on("tileloadstart",function(){D(e)}),f.on("tileloadend",function(){j(e)}),f.on("tileloaderror",function(){j(e)}));var p=new ol.layer.Tile({source:f,id:e,name:t,title:n,preload:1/0,visible:o});a?d.insertAt(0,p):d.push(p),s.setLayers(d)}return c},z=function(e){l=e},Z=function(e){u=e},_=function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({color:t,width:2})})},q=function(e){if(e.setVisible(!e.getVisible()),e.getLayers)for(var t=e.getLayers().getArray(),n=t.length,r=0;n>r;r++)t[r].setVisible(e.getVisible());$(document).trigger("layerVisibilityChange",[e.get("id")])},Q=function(e,t){var n=fe(r.getLayerGroup(),"id",e);if(n.setVisible(t),n.getLayers)for(var o=n.getLayers().getArray(),i=o.length,a=0;i>a;a++)o[a].setVisible(t);$(document).trigger("layerVisibilityChange",[e])},K=function(e){var t=fe(r.getLayerGroup(),"id",e);return t.get("visible")},U=function(e){$(document).unbind("layerVisibilityChange"),$(document).on("layerVisibilityChange",function(t,n){e(n)})},J=function(){r.addInteraction(e)},Y=function(){r.removeInteraction(e)},X=function(){var t=e.getGeometry().getExtent();return t},H=function(t){e.on("boxstart",function(e){t()})},ee=function(t){e.on("boxend",function(e){t()})},te=function(){var e=r.getView().calculateExtent(r.getSize());return e},ne=function(){r.getView().fit(t,r.getSize(),{constrainResolution:!1})},re=function(e){r.getView().fit(e,r.getSize(),{constrainResolution:!1})},oe=function(){return r.getView().getResolution()},ie=function(e){var t=fe(r.getLayerGroup(),"id",e),n=oe();return null!==t&&t.getMaxResolution()>=n&&t.getMinResolution()<=n},ae=function(e){null!==o&&r.getView().unByKey(o),o=r.getView().on("propertychange",function(t){switch(t.key){case"resolution":e()}})},le=function(e){null!==i&&r.getView().unByKey(i),i=r.on("dblclick",function(t){e(h(t.coordinate[0]),t.coordinate[1])})},ue=function(e){null!==a&&r.getView().unByKey(a),a=r.on("click",function(t){e(h(t.coordinate[0]),t.coordinate[1])})},se=function(){null!==a&&r.getView().unByKey(a)},ce=function(e,t){se(),ue(function(n,o){var i=fe(r.getLayerGroup(),"id",e).getSource(),a=[n,o],l=r.getView().getResolution(),u="EPSG:4326",s={INFO_FORMAT:"application/json"},c=i.getGetFeatureInfoUrl(a,l,u,s);t(c?c:null)})},de=function(){se()},fe=function(e,t,n){if(e.get(t)===n)return e;if(e.getLayers)for(var r,o=e.getLayers().getArray(),i=o.length,a=0;i>a;a++)if(r=fe(o[a],t,n))return r;return null},pe=function(e,t){fe(r.getLayerGroup(),"id",t).getSource().updateParams({CQL_FILTER:""==e?null:e})},me=function(e,t,n){var o=fe(r.getLayerGroup(),"id",e).getLayers(),i=o.removeAt(t);o.insertAt(n,i)},ye=function(){n=new ol.format.WMSCapabilities,r.getLayerGroup().set("id","terrama2-layerexplorer"),r.getLayerGroup().set("name","terrama2-layerexplorer"),e=new ol.interaction.DragBox({condition:ol.events.condition.always}),t=r.getView().calculateExtent(r.getSize()),$(".ol-attribution > button > span").html("©"),$(document).ready(function(){f()})};return{getMap:d,updateMapSize:f,updateLayerSourceParams:p,updateLayerAttribute:g,addMousePosition:x,removeMousePosition:M,addScale:C,removeScale:w,enableDoubleClickZoom:E,disableDoubleClickZoom:S,addLayerGroup:R,updateLayerTime:m,addTileWMSLayer:I,addWMTSLayer:W,addBingMapsLayer:P,addGeoJSONVectorLayer:B,removeLayer:F,addOSMLayer:N,setLayersStartLoadingFunction:z,setLayersEndLoadingFunction:Z,setLayerVisibility:q,setLayerVisibilityById:Q,isLayerVisible:K,setLayerVisibilityChangeEvent:U,addZoomDragBox:J,removeZoomDragBox:Y,getZoomDragBoxExtent:X,setZoomDragBoxStartEvent:H,setZoomDragBoxEndEvent:ee,getCurrentExtent:te,zoomToInitialExtent:ne,zoomToExtent:re,getCurrentResolution:oe,isCurrentResolutionValidForLayer:ie,setMapResolutionChangeEvent:ae,setMapDoubleClickEvent:le,setMapSingleClickEvent:ue,unsetMapSingleClickEvent:se,setGetFeatureInfoUrlOnClick:ce,unsetGetFeatureInfoUrlOnClick:de,findBy:fe,applyCQLFilter:pe,alterLayerIndex:me,init:ye,updateLayerOpacity:y,getLayerOpacity:v}}),n("TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents"],function(e){var t=null,n=null,r=null,o=function(){return t},i=function(e,t,n,r,o,i){return o=""!==o?" "+o:o,"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='parent_li"+o+"' style='"+i+"'><span class='group-name'><div class='terrama2-layerexplorer-plus'></div><span>"+t+"</span></span><ul class='children'>"+r+"</ul></li>"},a=function(e,t,n,r,o,i,a,l){var u=o?"<input type='checkbox' class='terrama2-layerexplorer-checkbox' checked/>":"<input type='checkbox' class='terrama2-layerexplorer-checkbox'/>";return a=""!==a?a+" ":a,a+=i?"layer disabled-content":"layer","<li data-layerid='"+e+"' data-parentid='"+r+"' title='"+n+"' id='"+e.replace(":","")+"' class='"+a+"' style='"+l+"'>"+u+"<span class='terrama2-layerexplorer-checkbox-span'>"+t+"</span></li>"},l=function(e,t,o,i,a){o=null!==o&&void 0!==o?o:!1,i=null!==i&&void 0!==i?i:"",a=null!==a&&void 0!==a?a:"";var l=n.findBy(r.getLayerGroup(),"id",e);if(null!==l){l.classes=i,l.style=a;var u=s(l,t);"terrama2-layerexplorer"===t?o?$("#"+t).append(u):$("#"+t).prepend(u):o?$("#"+t+" > ul.children").append(u):$("#"+t+" > ul.children").prepend(u),"function"==typeof $("input.opacity").slider&&$("input.opacity").slider(),$(".parent_li").find(" > ul > li").hide(),d()}},u=function(e,t){$("#"+e.replace(":","")).remove(),n.removeLayer(e,t)},s=function(e,t){var n="";if(e.getLayers){for(var r="",o=e.getLayers().getArray(),l=o.length,u=0;l>u;u++){var c=r;r=s(o[u],e.get("id"))+c}$("#"+e.get("id").replace(":","")).length||(n=i(e.get("id"),e.get("name"),t,r,e.classes,e.style))}else $("#"+e.get("id").replace(":","")).length||(n=a(e.get("id"),e.get("name"),e.get("title"),t,e.get("visible"),e.get("disabled"),e.classes,e.style));return n},c=function(){$("#terrama2-layerexplorer").on("click","span.group-name",function(e){var t=$(this).parent("li.parent_li").find(" > ul > li");t.is(":visible")?(t.hide("fast"),$(this).find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus"),$(this).parent("li.parent_li").removeClass("open")):(t.show("fast"),$(this).find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus"),$(this).parent("li.parent_li").addClass("open"))}),$("input.opacity").on("slide",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);o.setOpacity(e.value)}),$("#terrama2-layerexplorer").on("click","input.terrama2-layerexplorer-checkbox",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);if(null!==o){n.setLayerVisibility(o);var i=$(this).parent("li.parent_li").find(" > ul > li"),a=$(this).parent("li.parent_li").find(" > span");i.is(":visible")||!o.getVisible()?(i.hide("fast"),a.find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus")):(i.show("fast"),a.find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus"))}e.stopPropagation()})},d=function(){"function"==typeof $(".children").sortable&&($(".children").sortable({items:"li:not(.unsortable)",start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$(".children").disableSelection(),$("#terrama2-layerexplorer").sortable({items:"li:not(.unsortable)",start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$("#terrama2-layerexplorer").disableSelection())},f=function(){n=e,r=n.getMap(),c()};return{getSelectedLayer:o,addLayersFromMap:l,removeLayer:u,init:f}}),t("TerraMA2WebComponents")});