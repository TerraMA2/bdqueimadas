/*! TerraMA2WebComponents 4.0.0-alpha2 | (C) 2007, 2016 National Institute For Space Research (INPE) - Brazil | https://github.com/TerraMA2/terrama2/blob/master/LICENSE */
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.TerraMA2WebComponents=t()}(this,function(){var e,t,n;if(function(r){function o(e,t){return x.call(e,t)}function i(e,t){var n,r,o,i,a,l,s,u,c,d,p,f,y=t&&t.split("/"),m=h.map,g=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&C.test(e[a])&&(e[a]=e[a].replace(C,"")),"."===e[0].charAt(0)&&y&&(f=y.slice(0,y.length-1),e=f.concat(e)),c=0;c<e.length;c++)if(p=e[c],"."===p)e.splice(c,1),c-=1;else if(".."===p){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((y||g)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),y)for(d=y.length;d>0;d-=1)if(o=m[y.slice(0,d).join("/")],o&&(o=o[r])){i=o,l=c;break}if(i)break;!s&&g&&g[r]&&(s=g[r],u=c)}!i&&s&&(i=s,l=u),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=L.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),f.apply(r,n.concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function s(e){return function(t){g[e]=t}}function u(e){if(o(v,e)){var t=v[e];delete v[e],b[e]=!0,p.apply(r,t)}if(!o(g,e)&&!o(b,e))throw new Error("No "+e);return g[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return h&&h.config&&h.config[e]||{}}}var p,f,y,m,g={},v={},h={},b={},x=Object.prototype.hasOwnProperty,L=[].slice,C=/\.js$/;y=function(e,t){var n,r=c(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=u(o)),o?e=n&&n.normalize?n.normalize(e,l(t)):i(e,t):(e=i(e,t),r=c(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return a(e)},exports:function(e){var t=g[e];return"undefined"!=typeof t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:d(e)}}},p=function(e,t,n,i){var l,c,d,p,f,h,x=[],L=typeof n;if(i=i||e,"undefined"===L||"function"===L){for(t=!t.length&&n.length?["require","exports","module"]:t,f=0;f<t.length;f+=1)if(p=y(t[f],i),c=p.f,"require"===c)x[f]=m.require(e);else if("exports"===c)x[f]=m.exports(e),h=!0;else if("module"===c)l=x[f]=m.module(e);else if(o(g,c)||o(v,c)||o(b,c))x[f]=u(c);else{if(!p.p)throw new Error(e+" missing "+c);p.p.load(p.n,a(i,!0),s(c),{}),x[f]=g[c]}d=n?n.apply(g[e],x):void 0,e&&(l&&l.exports!==r&&l.exports!==g[e]?g[e]=l.exports:d===r&&h||(g[e]=d))}else e&&(g[e]=n)},e=t=f=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):u(y(e,t).f);if(!e.splice){if(h=e,h.deps&&f(h.deps,h.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),f},f.config=function(e){return f(e)},e._defined=g,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(g,e)||o(v,e)||(v[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("externals/almond",function(){}),"undefined"==typeof jQuery)throw new Error("TerraMA2WebComponents requires jQuery");if("undefined"==typeof ol)throw new Error("TerraMA2WebComponents requires Openlayers 3");return n("TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents","TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents"],function(e,t){return{MapDisplay:e,LayerExplorer:t}}),n("TerraMA2WebComponentsPath/TerraMA2WebComponents",function(){}),n("TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents",[],function(){var e=null,t=null,n=null,r=new ol.Map({renderer:"canvas",target:"terrama2-map",view:new ol.View({projection:"EPSG:4326",center:[-55,-15],zoom:3})}),o=null,i=null,a=null,l=null,s=null,u=null,c=null,d={},p={},f=function(){return r},y=function(){var e=window.setInterval(function(){r.updateSize()},100);window.setTimeout(function(){clearInterval(e)},2e3)},m=function(e,t,n){var o=ie(r.getLayerGroup(),"id",e);o.getSource().updateParams(t),n&&o.getSource().refresh()},g=function(e,t,n){var o=ie(r.getLayerGroup(),"id",e);o.set(t,n,!1)},v=function(e){var t=parseFloat(e),n=parseFloat(e);if(n>180||-180>=n){e=0>n?-1*e:parseFloat(e);var r=0;r=n/180%2===-0?e/180:n/180%2===-1?e/180+1:e/180%1===0?e/180-1:parseInt(e/180)%2===0?parseInt(e/180):Math.ceil(e/180),r>0&&(t=0>n?n+180*r:n-180*r)}return t},h=function(){var e=!1;if(r.getControls().forEach(function(t,n){return t instanceof ol.control.MousePosition?void(e=!0):void 0}),!e){$("#terrama2-map").append('<div id="terrama2-map-info"></div>');var t=new ol.control.MousePosition({coordinateFormat:function(e){return function(t){return ol.coordinate.toStringXY([v(t[0]),t[1]],e)}}(6),projection:"EPSG:4326",className:"terrama2-mouse-position",target:document.getElementById("terrama2-map-info")});r.addControl(t)}},b=function(){$("#terrama2-map-info").remove(),r.getControls().forEach(function(e,t){return e instanceof ol.control.MousePosition?void r.removeControl(e):void 0})},x=function(){var e=!1;r.getControls().forEach(function(t,n){return t instanceof ol.control.ScaleLine?void(e=!0):void 0}),e||r.addControl(new ol.control.ScaleLine)},L=function(){r.getControls().forEach(function(e,t){return e instanceof ol.control.ScaleLine?void r.removeControl(e):void 0})},C=function(){var e=!1;r.getInteractions().forEach(function(t,n){return t instanceof ol.interaction.DoubleClickZoom?void(e=!0):void 0}),e||r.addInteraction(new ol.interaction.DoubleClickZoom)},M=function(){r.getInteractions().forEach(function(e,t){return e instanceof ol.interaction.DoubleClickZoom?void r.removeInteraction(e):void 0})},w=function(e,t){var n=new ol.layer.Group({id:e,name:t});return n},E=function(e,t){var n=ie(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers();i.push(w(e,t)),n.setLayers(i)}return o},S=function(e,t,n,r,o,i,a,l,s){var d={LAYERS:n,TILED:!0};null!==l&&void 0!==l&&""!==l&&(d.TIME=l);var p=new ol.source.TileWMS({preload:1/0,url:e,serverType:t,params:d});null!==u&&null!==c&&(p.on("tileloadstart",function(){k(n)}),p.on("tileloadend",function(){G(n)}),p.on("tileloaderror",function(){G(n)}));var f=new ol.layer.Tile({source:p,id:n,name:r,visible:o,disabled:s});return void 0!==i&&null!==i&&f.setMinResolution(i),void 0!==a&&null!==a&&f.setMaxResolution(a),f},T=function(e,t,n,o,i,a,l,s,u,c){var d=ie(r.getLayerGroup(),"id",s),p=null!==d;if(p){var f=d.getLayers();f.push(S(e,t,n,o,i,a,l,u,c)),d.setLayers(f)}return p},V=function(e,t,n,r,o,i,a,l,s){var u=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox}),style:function(e){var t=s(e,a,l);return q(t.fillColor,t.strokeColor)},id:t,name:n,visible:r});return void 0!==o&&null!==o&&u.setMinResolution(o),void 0!==i&&null!==i&&u.setMaxResolution(i),u},A=function(e,t,n,o,i,a,l,s,u,c){var d=ie(r.getLayerGroup(),"id",c),p=null!==d;if(p){var f=d.getLayers();f.push(V(e,t,n,o,i,a,l,s,u)),d.setLayers(f)}return p},k=function(e){void 0===d[e]&&(d[e]=0),0===d[e]&&u(),++d[e]},G=function(e){void 0===d[e]&&(d[e]=0),void 0===p[e]&&(p[e]=0),setTimeout(function(){++p[e],d[e]===p[e]&&(d[e]=0,p[e]=0,c())},500)},I=function(e,t){var n=ie(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers(),a=new ol.source.OSM,l=new ol.source.MapQuest({layer:"osm"}),s=new ol.source.MapQuest({layer:"sat"});null!==u&&null!==c&&(a.on("tileloadstart",function(){k("osm")}),a.on("tileloadend",function(){G("osm")}),a.on("tileloaderror",function(){G("osm")}),l.on("tileloadstart",function(){k("mapquest_osm")}),l.on("tileloadend",function(){G("mapquest_osm")}),l.on("tileloaderror",function(){G("mapquest_osm")}),s.on("tileloadstart",function(){k("mapquest_sat")}),s.on("tileloadend",function(){G("mapquest_sat")}),s.on("tileloaderror",function(){G("mapquest_sat")})),i.push(new ol.layer.Group({layers:[new ol.layer.Tile({source:a,id:"osm",name:"Open Street Map",visible:!1}),new ol.layer.Tile({source:l,id:"mapquest_osm",name:"MapQuest OSM",visible:!1}),new ol.layer.Tile({source:s,id:"mapquest_sat",name:"MapQuest Sat&eacute;lite",visible:!0})],id:e,name:t})),n.setLayers(i)}return o},W=function(e,t,n,o){var i=ie(r.getLayerGroup(),"id",o),a=null!==i;if(a){var l=i.getLayers(),s=new ol.source.OSM;null!==u&&null!==c&&(s.on("tileloadstart",function(){k(e)}),s.on("tileloadend",function(){G(e)}),s.on("tileloaderror",function(){G(e)})),l.push(new ol.layer.Tile({source:s,id:e,name:t,visible:n})),i.setLayers(l)}return a},P=function(e,t,n,o){var i=ie(r.getLayerGroup(),"id",o),a=null!==i;if(a){var l=i.getLayers(),s=new ol.source.MapQuest({layer:"osm"});null!==u&&null!==c&&(s.on("tileloadstart",function(){k(e)}),s.on("tileloadend",function(){G(e)}),s.on("tileloaderror",function(){G(e)})),l.push(new ol.layer.Tile({source:s,id:e,name:t,visible:n})),i.setLayers(l)}return a},D=function(e,t,n,o){var i=ie(r.getLayerGroup(),"id",o),a=null!==i;if(a){var l=i.getLayers(),s=new ol.source.MapQuest({layer:"sat"});null!==u&&null!==c&&(s.on("tileloadstart",function(){k(e)}),s.on("tileloadend",function(){G(e)}),s.on("tileloaderror",function(){G(e)})),l.push(new ol.layer.Tile({source:s,id:e,name:t,visible:n})),i.setLayers(l)}return a},_=function(e,t,n,r,o,i){s=i,l.emit("proxyRequest",{url:e,additionalParameters:{serverUrl:t,serverType:n,serverId:r,serverName:o}})},B=function(e){u=e},R=function(e){c=e},q=function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({color:t,width:2})})},O=function(e){if(e.setVisible(!e.getVisible()),e.getLayers)for(var t=e.getLayers().getArray(),n=t.length,r=0;n>r;r++)t[r].setVisible(e.getVisible());$(document).trigger("layerVisibilityChange",[e.get("id")])},Q=function(e,t){var n=ie(r.getLayerGroup(),"id",e);if(n.setVisible(t),n.getLayers)for(var o=n.getLayers().getArray(),i=o.length,a=0;i>a;a++)o[a].setVisible(t);$(document).trigger("layerVisibilityChange",[e])},j=function(e){var t=ie(r.getLayerGroup(),"id",e);return t.get("visible")},z=function(e){$(document).unbind("layerVisibilityChange"),$(document).on("layerVisibilityChange",function(t,n){e(n)})},F=function(){r.addInteraction(e)},Z=function(){r.removeInteraction(e)},N=function(){var t=e.getGeometry().getExtent();return t},K=function(t){e.on("boxstart",function(e){t()})},J=function(t){e.on("boxend",function(e){t()})},Y=function(){var e=r.getView().calculateExtent(r.getSize());return e},U=function(){r.getView().fit(t,r.getSize(),{constrainResolution:!1})},X=function(e){r.getView().fit(e,r.getSize(),{constrainResolution:!1})},H=function(){return r.getView().getResolution()},ee=function(e){var t=ie(r.getLayerGroup(),"id",e),n=H();return null!==t&&t.getMaxResolution()>=n&&t.getMinResolution()<=n},te=function(e){null!==o&&r.getView().unByKey(o),o=r.getView().on("propertychange",function(t){switch(t.key){case"resolution":e()}})},ne=function(e){null!==i&&r.getView().unByKey(i),i=r.on("dblclick",function(t){e(v(t.coordinate[0]),t.coordinate[1])})},re=function(e){null!==a&&r.getView().unByKey(a),a=r.on("click",function(t){e(v(t.coordinate[0]),t.coordinate[1])})},oe=function(){null!==a&&r.getView().unByKey(a)},ie=function(e,t,n){if(e.get(t)===n)return e;if(e.getLayers)for(var r,o=e.getLayers().getArray(),i=o.length,a=0;i>a;a++)if(r=ie(o[a],t,n))return r;return null},ae=function(e,t){ie(r.getLayerGroup(),"id",t).getSource().updateParams({CQL_FILTER:e})},le=function(e,t,n){var o=ie(r.getLayerGroup(),"id",e).getLayers(),i=o.removeAt(t);o.insertAt(n,i)},se=function(){n=new ol.format.WMSCapabilities,r.getLayerGroup().set("id","terrama2-layerexplorer"),r.getLayerGroup().set("name","terrama2-layerexplorer"),e=new ol.interaction.DragBox({condition:ol.events.condition.always}),t=r.getView().calculateExtent(r.getSize()),$(document).ready(function(){y()})};return{getMap:f,updateMapSize:y,updateLayerSourceParams:m,updateLayerAttribute:g,addMousePosition:h,removeMousePosition:b,addScale:x,removeScale:L,enableDoubleClickZoom:C,disableDoubleClickZoom:M,addLayerGroup:E,createTileWMS:S,addTileWMSLayer:T,addGeoJSONVectorLayer:A,addBaseLayers:I,addOSMLayer:W,addMapQuestOSMLayer:P,addMapQuestSatelliteLayer:D,addCapabilitiesLayers:_,setLayersStartLoadingFunction:B,setLayersEndLoadingFunction:R,setLayerVisibility:O,setLayerVisibilityById:Q,isLayerVisible:j,setLayerVisibilityChangeEvent:z,addZoomDragBox:F,removeZoomDragBox:Z,getZoomDragBoxExtent:N,setZoomDragBoxStartEvent:K,setZoomDragBoxEndEvent:J,getCurrentExtent:Y,zoomToInitialExtent:U,zoomToExtent:X,getCurrentResolution:H,isCurrentResolutionValidForLayer:ee,setMapResolutionChangeEvent:te,setMapDoubleClickEvent:ne,setMapSingleClickEvent:re,unsetMapSingleClickEvent:oe,findBy:ie,applyCQLFilter:ae,alterLayerIndex:le,init:se}}),n("TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents"],function(e){var t=null,n=null,r=null,o=function(){return t},i=function(e,t,n,r){return"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='parent_li'><span class='group-name'><div class='terrama2-layerexplorer-plus'>+</div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+t+"</span><ul class='children'>"+r+"</ul></li>"},a=function(e,t,n,r,o){var i=r?"<input type='checkbox' class='terrama2-layerexplorer-checkbox' checked/>":"<input type='checkbox' class='terrama2-layerexplorer-checkbox'/>",a=o?"layer disabled-content":"layer";return"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='"+a+"'>"+i+"<span class='terrama2-layerexplorer-checkbox-span'>"+t+"</span></li>"},l=function(e,t){var o=n.findBy(r.getLayerGroup(),"id",e);if(null!==o){var i=s(o,t);"terrama2-layerexplorer"===t?$("#"+t).prepend(i):$("#"+t+" > ul.children").prepend(i),$("input.opacity").slider(),$(".parent_li").find(" > ul > li").hide(),c()}},s=function(e,t){var n="";if(e.getLayers){for(var r="",o=e.getLayers().getArray(),l=o.length,u=0;l>u;u++){var c=r;r=s(o[u],e.get("id"))+c}$("#"+e.get("id").replace(":","")).length||(n=i(e.get("id"),e.get("name"),t,r))}else $("#"+e.get("id").replace(":","")).length||(n=a(e.get("id"),e.get("name"),t,e.get("visible"),e.get("disabled")));return n},u=function(){$("#terrama2-layerexplorer").on("click","span.group-name",function(e){var t=$(this).parent("li.parent_li").find(" > ul > li");t.is(":visible")?(t.hide("fast"),$(this).find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+"),$(this).parent("li.parent_li").removeClass("open")):(t.show("fast"),$(this).find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"),$(this).parent("li.parent_li").addClass("open"))}),$("input.opacity").on("slide",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);o.setOpacity(e.value)}),$("#terrama2-layerexplorer").on("click","input.terrama2-layerexplorer-checkbox",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);if(null!==o){n.setLayerVisibility(o);var i=$(this).parent("li.parent_li").find(" > ul > li"),a=$(this).parent("li.parent_li").find(" > span");i.is(":visible")||!o.getVisible()?(i.hide("fast"),a.find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+")):(i.show("fast"),a.find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"))}e.stopPropagation()}),$("#terrama2-layerexplorer").on("click","li.layer",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t=null):($("li.parent_li ul li").removeClass("selected"),$(this).addClass("selected"),t=$(this).attr("data-layerid"))})},c=function(){$(".children").sortable({start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$(".children").disableSelection(),$("#terrama2-layerexplorer").sortable({start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$("#terrama2-layerexplorer").disableSelection()},d=function(){n=e,r=n.getMap(),u()};return{getSelectedLayer:o,addLayersFromMap:l,init:d}}),t("TerraMA2WebComponents")});