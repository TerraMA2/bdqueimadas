/*! TerraMA2WebComponents 4.0.0-alpha2 | (C) 2007, 2016 National Institute For Space Research (INPE) - Brazil | https://github.com/TerraMA2/terrama2/blob/master/LICENSE */
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.TerraMA2WebComponents=t()}(this,function(){var e,t,n;if(function(r){function o(e,t){return L.call(e,t)}function i(e,t){var n,r,o,i,a,l,u,s,c,d,p,f,y=t&&t.split("/"),m=h.map,v=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&C.test(e[a])&&(e[a]=e[a].replace(C,"")),"."===e[0].charAt(0)&&y&&(f=y.slice(0,y.length-1),e=f.concat(e)),c=0;c<e.length;c++)if(p=e[c],"."===p)e.splice(c,1),c-=1;else if(".."===p){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((y||v)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),y)for(d=y.length;d>0;d-=1)if(o=m[y.slice(0,d).join("/")],o&&(o=o[r])){i=o,l=c;break}if(i)break;!u&&v&&v[r]&&(u=v[r],s=c)}!i&&u&&(i=u,l=s),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),f.apply(r,n.concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function u(e){return function(t){v[e]=t}}function s(e){if(o(g,e)){var t=g[e];delete g[e],b[e]=!0,p.apply(r,t)}if(!o(v,e)&&!o(b,e))throw new Error("No "+e);return v[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return h&&h.config&&h.config[e]||{}}}var p,f,y,m,v={},g={},h={},b={},L=Object.prototype.hasOwnProperty,x=[].slice,C=/\.js$/;y=function(e,t){var n,r=c(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=s(o)),o?e=n&&n.normalize?n.normalize(e,l(t)):i(e,t):(e=i(e,t),r=c(e),o=r[0],e=r[1],o&&(n=s(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return a(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},p=function(e,t,n,i){var l,c,d,p,f,h,L=[],x=typeof n;if(i=i||e,"undefined"===x||"function"===x){for(t=!t.length&&n.length?["require","exports","module"]:t,f=0;f<t.length;f+=1)if(p=y(t[f],i),c=p.f,"require"===c)L[f]=m.require(e);else if("exports"===c)L[f]=m.exports(e),h=!0;else if("module"===c)l=L[f]=m.module(e);else if(o(v,c)||o(g,c)||o(b,c))L[f]=s(c);else{if(!p.p)throw new Error(e+" missing "+c);p.p.load(p.n,a(i,!0),u(c),{}),L[f]=v[c]}d=n?n.apply(v[e],L):void 0,e&&(l&&l.exports!==r&&l.exports!==v[e]?v[e]=l.exports:d===r&&h||(v[e]=d))}else e&&(v[e]=n)},e=t=f=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):s(y(e,t).f);if(!e.splice){if(h=e,h.deps&&f(h.deps,h.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),f},f.config=function(e){return f(e)},e._defined=v,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(v,e)||o(g,e)||(g[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("externals/almond",function(){}),"undefined"==typeof jQuery)throw new Error("TerraMA2WebComponents requires jQuery");if("undefined"==typeof ol)throw new Error("TerraMA2WebComponents requires Openlayers 3");return n("TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents","TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents"],function(e,t){return{MapDisplay:e,LayerExplorer:t}}),n("TerraMA2WebComponentsPath/TerraMA2WebComponents",function(){}),n("TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents",[],function(){var e=null,t=null,n=null,r=new ol.Map({renderer:"canvas",target:"terrama2-map",view:new ol.View({projection:"EPSG:4326",center:[-55,-15],zoom:3})}),o=null,i=null,a=null,l=null,u=null,s=null,c=null,d={},p={},f=function(){return r},y=function(){var e=window.setInterval(function(){r.updateSize()},100);window.setTimeout(function(){clearInterval(e)},2e3)},m=function(e,t,n){var o=ce(r.getLayerGroup(),"id",e);o.getSource().updateParams(t),n&&o.getSource().refresh()},v=function(e,t,n){var o=ce(r.getLayerGroup(),"id",e);o.set(t,n,!1)},g=function(e){var t=parseFloat(e),n=parseFloat(e);if(n>180||-180>=n){e=0>n?-1*e:parseFloat(e);var r=0;r=n/180%2===-0?e/180:n/180%2===-1?e/180+1:e/180%1===0?e/180-1:parseInt(e/180)%2===0?parseInt(e/180):Math.ceil(e/180),r>0&&(t=0>n?n+180*r:n-180*r)}return t},h=function(e,t){var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60),i=o;o=Math.floor(o);var a=(i-o)/(1/60);a=Math.round(10*a),a/=10,10>r&&(r="0"+r),10>o&&(o="0"+o),10>a&&(a="0"+a);var l=r+" "+o+" "+a+" "+b(e,t);return l},b=function(e,t){var n="";return"LAT"==t?n=e>=0?"N":"S":"LON"==t&&(n=e>=0?"E":"W"),n},L=function(){var e=!1;if(r.getControls().forEach(function(t,n){return t instanceof ol.control.MousePosition?void(e=!0):void 0}),!e){$("#terrama2-map").append('<div id="terrama2-map-info"></div>');var t=new ol.control.MousePosition({coordinateFormat:function(e){return function(t){return ol.coordinate.toStringXY([g(t[0]),t[1]],e)+"<br/>"+h(g(t[0]),"LON")+", "+h(t[1],"LAT")}}(6),projection:"EPSG:4326",className:"terrama2-mouse-position",target:document.getElementById("terrama2-map-info")});r.addControl(t)}},x=function(){$("#terrama2-map-info").remove(),r.getControls().forEach(function(e,t){return e instanceof ol.control.MousePosition?void r.removeControl(e):void 0})},C=function(){var e=!1;r.getControls().forEach(function(t,n){return t instanceof ol.control.ScaleLine?void(e=!0):void 0}),e||r.addControl(new ol.control.ScaleLine)},M=function(){r.getControls().forEach(function(e,t){return e instanceof ol.control.ScaleLine?void r.removeControl(e):void 0})},w=function(){var e=!1;r.getInteractions().forEach(function(t,n){return t instanceof ol.interaction.DoubleClickZoom?void(e=!0):void 0}),e||r.addInteraction(new ol.interaction.DoubleClickZoom)},E=function(){r.getInteractions().forEach(function(e,t){return e instanceof ol.interaction.DoubleClickZoom?void r.removeInteraction(e):void 0})},S=function(e,t){var n=new ol.layer.Group({id:e,name:t});return n},T=function(e,t){var n=ce(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers();i.push(S(e,t)),n.setLayers(i)}return o},G=function(e,t,n,r,o,i,a,l,u){var d={LAYERS:n,TILED:!0};null!==l&&void 0!==l&&""!==l&&(d.TIME=l);var p=new ol.source.TileWMS({preload:1/0,url:e,serverType:t,params:d});null!==s&&null!==c&&(p.on("tileloadstart",function(){W(n)}),p.on("tileloadend",function(){P(n)}),p.on("tileloaderror",function(){P(n)}));var f=new ol.layer.Tile({source:p,id:n,name:r,visible:o,disabled:u});return void 0!==i&&null!==i&&f.setMinResolution(i),void 0!==a&&null!==a&&f.setMaxResolution(a),f},A=function(e,t,n,o,i,a,l,u,s,c){var d=ce(r.getLayerGroup(),"id",u),p=null!==d;if(p){var f=d.getLayers();f.push(G(e,t,n,o,i,a,l,s,c)),d.setLayers(f)}return p},V=function(e,t,n,r,o,i,a,l,u){var s=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox}),style:function(e){var t=u(e,a,l);return N(t.fillColor,t.strokeColor)},id:t,name:n,visible:r});return void 0!==o&&null!==o&&s.setMinResolution(o),void 0!==i&&null!==i&&s.setMaxResolution(i),s},k=function(e,t,n,o,i,a,l,u,s,c){var d=ce(r.getLayerGroup(),"id",c),p=null!==d;if(p){var f=d.getLayers();f.push(V(e,t,n,o,i,a,l,u,s)),d.setLayers(f)}return p},I=function(e,t){if("undefined"!==t&&"undefined"!==t&&void 0!==t&&null!==t){var n=ce(r.getLayerGroup(),"id",t),o=n.getLayers();o.forEach(function(t,n,r){return e===t.get("id")?(o.remove(t),!1):void 0}),n.setLayers(o)}else{var i=ce(r.getLayerGroup(),"id",e);r.removeLayer(i)}},W=function(e){void 0===d[e]&&(d[e]=0),0===d[e]&&s(),++d[e]},P=function(e){void 0===d[e]&&(d[e]=0),void 0===p[e]&&(p[e]=0),setTimeout(function(){++p[e],d[e]===p[e]&&(d[e]=0,p[e]=0,c())},500)},O=function(e,t){var n=ce(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers(),a=new ol.source.OSM,l=new ol.source.MapQuest({layer:"osm"}),u=new ol.source.MapQuest({layer:"sat"});null!==s&&null!==c&&(a.on("tileloadstart",function(){W("osm")}),a.on("tileloadend",function(){P("osm")}),a.on("tileloaderror",function(){P("osm")}),l.on("tileloadstart",function(){W("mapquest_osm")}),l.on("tileloadend",function(){P("mapquest_osm")}),l.on("tileloaderror",function(){P("mapquest_osm")}),u.on("tileloadstart",function(){W("mapquest_sat")}),u.on("tileloadend",function(){P("mapquest_sat")}),u.on("tileloaderror",function(){P("mapquest_sat")})),i.push(new ol.layer.Group({layers:[new ol.layer.Tile({source:a,id:"osm",name:"Open Street Map",visible:!1}),new ol.layer.Tile({source:l,id:"mapquest_osm",name:"MapQuest OSM",visible:!1}),new ol.layer.Tile({source:u,id:"mapquest_sat",name:"MapQuest Sat&eacute;lite",visible:!0})],id:e,name:t})),n.setLayers(i)}return o},_=function(e,t,n,o){var i=ce(r.getLayerGroup(),"id",o),a=null!==i;if(a){var l=i.getLayers(),u=new ol.source.OSM;null!==s&&null!==c&&(u.on("tileloadstart",function(){W(e)}),u.on("tileloadend",function(){P(e)}),u.on("tileloaderror",function(){P(e)})),l.push(new ol.layer.Tile({source:u,id:e,name:t,visible:n})),i.setLayers(l)}return a},D=function(e,t,n,o){var i=ce(r.getLayerGroup(),"id",o),a=null!==i;if(a){var l=i.getLayers(),u=new ol.source.MapQuest({layer:"osm"});null!==s&&null!==c&&(u.on("tileloadstart",function(){W(e)}),u.on("tileloadend",function(){P(e)}),u.on("tileloaderror",function(){P(e)})),l.push(new ol.layer.Tile({source:u,id:e,name:t,visible:n})),i.setLayers(l)}return a},R=function(e,t,n,o){var i=ce(r.getLayerGroup(),"id",o),a=null!==i;if(a){var l=i.getLayers(),u=new ol.source.MapQuest({layer:"sat"});null!==s&&null!==c&&(u.on("tileloadstart",function(){W(e)}),u.on("tileloadend",function(){P(e)}),u.on("tileloaderror",function(){P(e)})),l.push(new ol.layer.Tile({source:u,id:e,name:t,visible:n})),i.setLayers(l)}return a},B=function(e,t,n,r,o,i){u=i,l.emit("proxyRequest",{url:e,additionalParameters:{serverUrl:t,serverType:n,serverId:r,serverName:o}})},F=function(e){s=e},q=function(e){c=e},N=function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({color:t,width:2})})},Q=function(e){if(e.setVisible(!e.getVisible()),e.getLayers)for(var t=e.getLayers().getArray(),n=t.length,r=0;n>r;r++)t[r].setVisible(e.getVisible());$(document).trigger("layerVisibilityChange",[e.get("id")])},j=function(e,t){var n=ce(r.getLayerGroup(),"id",e);if(n.setVisible(t),n.getLayers)for(var o=n.getLayers().getArray(),i=o.length,a=0;i>a;a++)o[a].setVisible(t);$(document).trigger("layerVisibilityChange",[e])},z=function(e){var t=ce(r.getLayerGroup(),"id",e);return t.get("visible")},Z=function(e){$(document).unbind("layerVisibilityChange"),$(document).on("layerVisibilityChange",function(t,n){e(n)})},K=function(){r.addInteraction(e)},U=function(){r.removeInteraction(e)},J=function(){var t=e.getGeometry().getExtent();return t},Y=function(t){e.on("boxstart",function(e){t()})},X=function(t){e.on("boxend",function(e){t()})},H=function(){var e=r.getView().calculateExtent(r.getSize());return e},ee=function(){r.getView().fit(t,r.getSize(),{constrainResolution:!1})},te=function(e){r.getView().fit(e,r.getSize(),{constrainResolution:!1})},ne=function(){return r.getView().getResolution()},re=function(e){var t=ce(r.getLayerGroup(),"id",e),n=ne();return null!==t&&t.getMaxResolution()>=n&&t.getMinResolution()<=n},oe=function(e){null!==o&&r.getView().unByKey(o),o=r.getView().on("propertychange",function(t){switch(t.key){case"resolution":e()}})},ie=function(e){null!==i&&r.getView().unByKey(i),i=r.on("dblclick",function(t){e(g(t.coordinate[0]),t.coordinate[1])})},ae=function(e){null!==a&&r.getView().unByKey(a),a=r.on("click",function(t){e(g(t.coordinate[0]),t.coordinate[1])})},le=function(){null!==a&&r.getView().unByKey(a)},ue=function(e,t){le(),ae(function(n,o){var i=ce(r.getLayerGroup(),"id",e).getSource(),a=[n,o],l=r.getView().getResolution(),u="EPSG:4326",s={INFO_FORMAT:"application/json"},c=i.getGetFeatureInfoUrl(a,l,u,s);t(c?c:null)})},se=function(){le()},ce=function(e,t,n){if(e.get(t)===n)return e;if(e.getLayers)for(var r,o=e.getLayers().getArray(),i=o.length,a=0;i>a;a++)if(r=ce(o[a],t,n))return r;return null},de=function(e,t){ce(r.getLayerGroup(),"id",t).getSource().updateParams({CQL_FILTER:e})},pe=function(e,t,n){var o=ce(r.getLayerGroup(),"id",e).getLayers(),i=o.removeAt(t);o.insertAt(n,i)},fe=function(){n=new ol.format.WMSCapabilities,r.getLayerGroup().set("id","terrama2-layerexplorer"),r.getLayerGroup().set("name","terrama2-layerexplorer"),e=new ol.interaction.DragBox({condition:ol.events.condition.always}),t=r.getView().calculateExtent(r.getSize()),$(".ol-attribution > button > span").html("©"),$(document).ready(function(){y()})};return{getMap:f,updateMapSize:y,updateLayerSourceParams:m,updateLayerAttribute:v,addMousePosition:L,removeMousePosition:x,addScale:C,removeScale:M,enableDoubleClickZoom:w,disableDoubleClickZoom:E,addLayerGroup:T,createTileWMS:G,addTileWMSLayer:A,addGeoJSONVectorLayer:k,removeLayer:I,addBaseLayers:O,addOSMLayer:_,addMapQuestOSMLayer:D,addMapQuestSatelliteLayer:R,addCapabilitiesLayers:B,setLayersStartLoadingFunction:F,setLayersEndLoadingFunction:q,setLayerVisibility:Q,setLayerVisibilityById:j,isLayerVisible:z,setLayerVisibilityChangeEvent:Z,addZoomDragBox:K,removeZoomDragBox:U,getZoomDragBoxExtent:J,setZoomDragBoxStartEvent:Y,setZoomDragBoxEndEvent:X,getCurrentExtent:H,zoomToInitialExtent:ee,zoomToExtent:te,getCurrentResolution:ne,isCurrentResolutionValidForLayer:re,setMapResolutionChangeEvent:oe,setMapDoubleClickEvent:ie,setMapSingleClickEvent:ae,unsetMapSingleClickEvent:le,setGetFeatureInfoUrlOnClick:ue,unsetGetFeatureInfoUrlOnClick:se,findBy:ce,applyCQLFilter:de,alterLayerIndex:pe,init:fe}}),n("TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents"],function(e){var t=null,n=null,r=null,o=function(){return t},i=function(e,t,n,r){return"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='parent_li'><span class='group-name'><div class='terrama2-layerexplorer-plus'>+</div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+t+"</span><ul class='children'>"+r+"</ul></li>"},a=function(e,t,n,r,o){var i=r?"<input type='checkbox' class='terrama2-layerexplorer-checkbox' checked/>":"<input type='checkbox' class='terrama2-layerexplorer-checkbox'/>",a=o?"layer disabled-content":"layer";return"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='"+a+"'>"+i+"<span class='terrama2-layerexplorer-checkbox-span'>"+t+"</span></li>"},l=function(e,t){var o=n.findBy(r.getLayerGroup(),"id",e);if(null!==o){var i=s(o,t);"terrama2-layerexplorer"===t?$("#"+t).prepend(i):$("#"+t+" > ul.children").prepend(i),$("input.opacity").slider(),$(".parent_li").find(" > ul > li").hide(),d()}},u=function(e,t){$("#"+e.replace(":","")).remove(),n.removeLayer(e,t)},s=function(e,t){var n="";if(e.getLayers){for(var r="",o=e.getLayers().getArray(),l=o.length,u=0;l>u;u++){var c=r;r=s(o[u],e.get("id"))+c}$("#"+e.get("id").replace(":","")).length||(n=i(e.get("id"),e.get("name"),t,r))}else $("#"+e.get("id").replace(":","")).length||(n=a(e.get("id"),e.get("name"),t,e.get("visible"),e.get("disabled")));return n},c=function(){$("#terrama2-layerexplorer").on("click","span.group-name",function(e){var t=$(this).parent("li.parent_li").find(" > ul > li");t.is(":visible")?(t.hide("fast"),$(this).find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+"),$(this).parent("li.parent_li").removeClass("open")):(t.show("fast"),$(this).find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"),$(this).parent("li.parent_li").addClass("open"))}),$("input.opacity").on("slide",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);o.setOpacity(e.value)}),$("#terrama2-layerexplorer").on("click","input.terrama2-layerexplorer-checkbox",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);if(null!==o){n.setLayerVisibility(o);var i=$(this).parent("li.parent_li").find(" > ul > li"),a=$(this).parent("li.parent_li").find(" > span");i.is(":visible")||!o.getVisible()?(i.hide("fast"),a.find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+")):(i.show("fast"),a.find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"))}e.stopPropagation()}),$("#terrama2-layerexplorer").on("click","li.layer",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t=null):($("li.parent_li ul li").removeClass("selected"),$(this).addClass("selected"),t=$(this).attr("data-layerid"))})},d=function(){$(".children").sortable({start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$(".children").disableSelection(),$("#terrama2-layerexplorer").sortable({start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$("#terrama2-layerexplorer").disableSelection()},p=function(){n=e,r=n.getMap(),c()};return{getSelectedLayer:o,addLayersFromMap:l,removeLayer:u,init:p}}),t("TerraMA2WebComponents")});