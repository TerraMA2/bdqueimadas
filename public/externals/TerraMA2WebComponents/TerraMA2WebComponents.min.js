/*! TerraMA2WebComponents 4.0.0-alpha2 | (C) 2007, 2016 National Institute For Space Research (INPE) - Brazil | https://github.com/TerraMA2/terrama2/blob/master/LICENSE */
!function(e,t){"function"==typeof define&&define.amd?define([],t):e.TerraMA2WebComponents=t()}(this,function(){var e,t,n;if(function(r){function o(e,t){return b.call(e,t)}function i(e,t){var n,r,o,i,a,l,u,s,c,d,f,p,y=t&&t.split("/"),m=h.map,v=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,h.nodeIdCompat&&C.test(e[a])&&(e[a]=e[a].replace(C,"")),"."===e[0].charAt(0)&&y&&(p=y.slice(0,y.length-1),e=p.concat(e)),c=0;c<e.length;c++)if(f=e[c],"."===f)e.splice(c,1),c-=1;else if(".."===f){if(0===c||1===c&&".."===e[2]||".."===e[c-1])continue;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}if((y||v)&&m){for(n=e.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),y)for(d=y.length;d>0;d-=1)if(o=m[y.slice(0,d).join("/")],o&&(o=o[r])){i=o,l=c;break}if(i)break;!u&&v&&v[r]&&(u=v[r],s=c)}!i&&u&&(i=u,l=s),i&&(n.splice(0,l,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),p.apply(r,n.concat([e,t]))}}function l(e){return function(t){return i(t,e)}}function u(e){return function(t){v[e]=t}}function s(e){if(o(g,e)){var t=g[e];delete g[e],L[e]=!0,f.apply(r,t)}if(!o(v,e)&&!o(L,e))throw new Error("No "+e);return v[e]}function c(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return h&&h.config&&h.config[e]||{}}}var f,p,y,m,v={},g={},h={},L={},b=Object.prototype.hasOwnProperty,x=[].slice,C=/\.js$/;y=function(e,t){var n,r=c(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=s(o)),o?e=n&&n.normalize?n.normalize(e,l(t)):i(e,t):(e=i(e,t),r=c(e),o=r[0],e=r[1],o&&(n=s(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return a(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:d(e)}}},f=function(e,t,n,i){var l,c,d,f,p,h,b=[],x=typeof n;if(i=i||e,"undefined"===x||"function"===x){for(t=!t.length&&n.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(f=y(t[p],i),c=f.f,"require"===c)b[p]=m.require(e);else if("exports"===c)b[p]=m.exports(e),h=!0;else if("module"===c)l=b[p]=m.module(e);else if(o(v,c)||o(g,c)||o(L,c))b[p]=s(c);else{if(!f.p)throw new Error(e+" missing "+c);f.p.load(f.n,a(i,!0),u(c),{}),b[p]=v[c]}d=n?n.apply(v[e],b):void 0,e&&(l&&l.exports!==r&&l.exports!==v[e]?v[e]=l.exports:d===r&&h||(v[e]=d))}else e&&(v[e]=n)},e=t=p=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):s(y(e,t).f);if(!e.splice){if(h=e,h.deps&&p(h.deps,h.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),p},p.config=function(e){return p(e)},e._defined=v,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(v,e)||o(g,e)||(g[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("externals/almond",function(){}),"undefined"==typeof jQuery)throw new Error("TerraMA2WebComponents requires jQuery");if("undefined"==typeof ol)throw new Error("TerraMA2WebComponents requires Openlayers 3");return n("TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents","TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents"],function(e,t){return{MapDisplay:e,LayerExplorer:t}}),n("TerraMA2WebComponentsPath/TerraMA2WebComponents",function(){}),n("TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents",[],function(){var e=null,t=null,n=null,r=new ol.Map({renderer:"canvas",target:"terrama2-map",view:new ol.View({projection:"EPSG:4326",center:[-55,-15],zoom:3})}),o=null,i=null,a=null,l=null,u=null,s={},c={},d=function(){return r},f=function(){var e=window.setInterval(function(){r.updateSize()},100);window.setTimeout(function(){clearInterval(e)},2e3)},p=function(e,t,n){var o=le(r.getLayerGroup(),"id",e);o.getSource().updateParams(t),n&&o.getSource().refresh()},y=function(e,t,n){var o=le(r.getLayerGroup(),"id",e);o.set(t,n,!1)},m=function(e){var t=parseFloat(e),n=parseFloat(e);if(n>180||-180>=n){e=0>n?-1*e:parseFloat(e);var r=0;r=n/180%2===-0?e/180:n/180%2===-1?e/180+1:e/180%1===0?e/180-1:parseInt(e/180)%2===0?parseInt(e/180):Math.ceil(e/180),r>0&&(t=0>n?n+180*r:n-180*r)}return t},v=function(e,t){var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60),i=o;o=Math.floor(o);var a=(i-o)/(1/60);a=Math.round(10*a),a/=10,10>r&&(r="0"+r),10>o&&(o="0"+o),10>a&&(a="0"+a);var l=r+" "+o+" "+a+" "+g(e,t);return l},g=function(e,t){var n="";return"LAT"==t?n=e>=0?"N":"S":"LON"==t&&(n=e>=0?"E":"W"),n},h=function(){var e=!1;if(r.getControls().forEach(function(t,n){return t instanceof ol.control.MousePosition?void(e=!0):void 0}),!e){$("#terrama2-map").append('<div id="terrama2-map-info"></div>');var t=new ol.control.MousePosition({coordinateFormat:function(e){return function(t){return ol.coordinate.toStringXY([m(t[0]),t[1]],e)+"<br/>"+v(m(t[0]),"LON")+", "+v(t[1],"LAT")}}(6),projection:"EPSG:4326",className:"terrama2-mouse-position",target:document.getElementById("terrama2-map-info")});r.addControl(t)}},L=function(){$("#terrama2-map-info").remove(),r.getControls().forEach(function(e,t){return e instanceof ol.control.MousePosition?void r.removeControl(e):void 0})},b=function(){var e=!1;r.getControls().forEach(function(t,n){return t instanceof ol.control.ScaleLine?void(e=!0):void 0}),e||r.addControl(new ol.control.ScaleLine)},x=function(){r.getControls().forEach(function(e,t){return e instanceof ol.control.ScaleLine?void r.removeControl(e):void 0})},C=function(){var e=!1;r.getInteractions().forEach(function(t,n){return t instanceof ol.interaction.DoubleClickZoom?void(e=!0):void 0}),e||r.addInteraction(new ol.interaction.DoubleClickZoom)},M=function(){r.getInteractions().forEach(function(e,t){return e instanceof ol.interaction.DoubleClickZoom?void r.removeInteraction(e):void 0})},w=function(e,t){var n=new ol.layer.Group({id:e,name:t});return n},E=function(e,t){var n=le(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers();i.push(w(e,t)),n.setLayers(i)}return o},S=function(e,t,n,r,o,i,a,s,c,d,f,p,y){var m={LAYERS:n,TILED:!0};null!==s&&void 0!==s&&""!==s&&(m.TIME=s),null!==d&&void 0!==d&&""!==d&&(m.BUFFER=d),null!==f&&void 0!==f&&""!==f&&(m.VERSION=f),null!==p&&void 0!==p&&""!==p&&(m.FORMAT=p);var v={preload:1/0,url:e,serverType:t,params:m};null!==y&&void 0!==y&&""!==y&&(v.tileGrid=new ol.tilegrid.TileGrid(y));var g=new ol.source.TileWMS(v);null!==l&&null!==u&&(g.on("tileloadstart",function(){k(n)}),g.on("tileloadend",function(){I(n)}),g.on("tileloaderror",function(){I(n)}));var h=new ol.layer.Tile({source:g,id:n,name:r,visible:o,disabled:c});return void 0!==i&&null!==i&&h.setMinResolution(i),void 0!==a&&null!==a&&h.setMaxResolution(a),h},T=function(e,t,n,o,i,a,l,u,s,c,d,f,p,y){var m=le(r.getLayerGroup(),"id",u),v=null!==m;if(v){var g=m.getLayers();g.push(S(e,t,n,o,i,a,l,s,c,d,f,p,y)),m.setLayers(g)}return v},A=function(e,t,n,r,o,i,a,l,u){var s=new ol.layer.Vector({source:new ol.source.Vector({url:e,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox}),style:function(e){var t=u(e,a,l);return B(t.fillColor,t.strokeColor)},id:t,name:n,visible:r});return void 0!==o&&null!==o&&s.setMinResolution(o),void 0!==i&&null!==i&&s.setMaxResolution(i),s},G=function(e,t,n,o,i,a,l,u,s,c){var d=le(r.getLayerGroup(),"id",c),f=null!==d;if(f){var p=d.getLayers();p.push(A(e,t,n,o,i,a,l,u,s)),d.setLayers(p)}return f},V=function(e,t){if("undefined"!==t&&"undefined"!==t&&void 0!==t&&null!==t){var n=le(r.getLayerGroup(),"id",t),o=n.getLayers();o.forEach(function(t,n,r){return e===t.get("id")?(o.remove(t),!1):void 0}),n.setLayers(o)}else{var i=le(r.getLayerGroup(),"id",e);r.removeLayer(i)}},k=function(e){void 0===s[e]&&(s[e]=0),0===s[e]&&l(),++s[e]},I=function(e){void 0===s[e]&&(s[e]=0),void 0===c[e]&&(c[e]=0),setTimeout(function(){++c[e],s[e]===c[e]&&(s[e]=0,c[e]=0,u())},500)},W=function(e,t){var n=le(r.getLayerGroup(),"id","terrama2-layerexplorer"),o=null!==n;if(o){var i=n.getLayers(),a=new ol.source.OSM,s=new ol.source.MapQuest({layer:"osm"}),c=new ol.source.MapQuest({layer:"sat"});null!==l&&null!==u&&(a.on("tileloadstart",function(){k("osm")}),a.on("tileloadend",function(){I("osm")}),a.on("tileloaderror",function(){I("osm")}),s.on("tileloadstart",function(){k("mapquest_osm")}),s.on("tileloadend",function(){I("mapquest_osm")}),s.on("tileloaderror",function(){I("mapquest_osm")}),c.on("tileloadstart",function(){k("mapquest_sat")}),c.on("tileloadend",function(){I("mapquest_sat")}),c.on("tileloaderror",function(){I("mapquest_sat")})),i.push(new ol.layer.Group({layers:[new ol.layer.Tile({source:a,id:"osm",name:"Open Street Map",visible:!1}),new ol.layer.Tile({source:s,id:"mapquest_osm",name:"MapQuest OSM",visible:!1}),new ol.layer.Tile({source:c,id:"mapquest_sat",name:"MapQuest Sat&eacute;lite",visible:!0})],id:e,name:t})),n.setLayers(i)}return o},O=function(e,t,n,o,i){i=null!==i&&void 0!==i?i:!1;var a=le(r.getLayerGroup(),"id",o),s=null!==a;if(s){var c=a.getLayers(),d=new ol.source.OSM;null!==l&&null!==u&&(d.on("tileloadstart",function(){k(e)}),d.on("tileloadend",function(){I(e)}),d.on("tileloaderror",function(){I(e)}));var f=new ol.layer.Tile({source:d,id:e,name:t,visible:n});i?c.insertAt(0,f):c.push(f),a.setLayers(c)}return s},R=function(e,t,n,o,i){i=null!==i&&void 0!==i?i:!1;var a=le(r.getLayerGroup(),"id",o),s=null!==a;if(s){var c=a.getLayers(),d=new ol.source.MapQuest({layer:"osm"});null!==l&&null!==u&&(d.on("tileloadstart",function(){k(e)}),d.on("tileloadend",function(){I(e)}),d.on("tileloaderror",function(){I(e)}));var f=new ol.layer.Tile({source:d,id:e,name:t,visible:n});i?c.insertAt(0,f):c.push(f),a.setLayers(c)}return s},F=function(e,t,n,o,i){i=null!==i&&void 0!==i?i:!1;var a=le(r.getLayerGroup(),"id",o),s=null!==a;if(s){var c=a.getLayers(),d=new ol.source.MapQuest({layer:"sat"});null!==l&&null!==u&&(d.on("tileloadstart",function(){k(e)}),d.on("tileloadend",function(){I(e)}),d.on("tileloaderror",function(){I(e)}));var f=new ol.layer.Tile({source:d,id:e,name:t,visible:n});i?c.insertAt(0,f):c.push(f),a.setLayers(c)}return s},P=function(e){l=e},_=function(e){u=e},B=function(e,t){return new ol.style.Style({fill:new ol.style.Fill({color:e}),stroke:new ol.style.Stroke({color:t,width:2})})},D=function(e){if(e.setVisible(!e.getVisible()),e.getLayers)for(var t=e.getLayers().getArray(),n=t.length,r=0;n>r;r++)t[r].setVisible(e.getVisible());$(document).trigger("layerVisibilityChange",[e.get("id")])},q=function(e,t){var n=le(r.getLayerGroup(),"id",e);if(n.setVisible(t),n.getLayers)for(var o=n.getLayers().getArray(),i=o.length,a=0;i>a;a++)o[a].setVisible(t);$(document).trigger("layerVisibilityChange",[e])},N=function(e){var t=le(r.getLayerGroup(),"id",e);return t.get("visible")},Q=function(e){$(document).unbind("layerVisibilityChange"),$(document).on("layerVisibilityChange",function(t,n){e(n)})},j=function(){r.addInteraction(e)},z=function(){r.removeInteraction(e)},Z=function(){var t=e.getGeometry().getExtent();return t},K=function(t){e.on("boxstart",function(e){t()})},U=function(t){e.on("boxend",function(e){t()})},J=function(){var e=r.getView().calculateExtent(r.getSize());return e},Y=function(){r.getView().fit(t,r.getSize(),{constrainResolution:!1})},X=function(e){r.getView().fit(e,r.getSize(),{constrainResolution:!1})},H=function(){return r.getView().getResolution()},ee=function(e){var t=le(r.getLayerGroup(),"id",e),n=H();return null!==t&&t.getMaxResolution()>=n&&t.getMinResolution()<=n},te=function(e){null!==o&&r.getView().unByKey(o),o=r.getView().on("propertychange",function(t){switch(t.key){case"resolution":e()}})},ne=function(e){null!==i&&r.getView().unByKey(i),i=r.on("dblclick",function(t){e(m(t.coordinate[0]),t.coordinate[1])})},re=function(e){null!==a&&r.getView().unByKey(a),a=r.on("click",function(t){e(m(t.coordinate[0]),t.coordinate[1])})},oe=function(){null!==a&&r.getView().unByKey(a)},ie=function(e,t){oe(),re(function(n,o){var i=le(r.getLayerGroup(),"id",e).getSource(),a=[n,o],l=r.getView().getResolution(),u="EPSG:4326",s={INFO_FORMAT:"application/json"},c=i.getGetFeatureInfoUrl(a,l,u,s);t(c?c:null)})},ae=function(){oe()},le=function(e,t,n){if(e.get(t)===n)return e;if(e.getLayers)for(var r,o=e.getLayers().getArray(),i=o.length,a=0;i>a;a++)if(r=le(o[a],t,n))return r;return null},ue=function(e,t){le(r.getLayerGroup(),"id",t).getSource().updateParams({CQL_FILTER:e})},se=function(e,t,n){var o=le(r.getLayerGroup(),"id",e).getLayers(),i=o.removeAt(t);o.insertAt(n,i)},ce=function(){n=new ol.format.WMSCapabilities,r.getLayerGroup().set("id","terrama2-layerexplorer"),r.getLayerGroup().set("name","terrama2-layerexplorer"),e=new ol.interaction.DragBox({condition:ol.events.condition.always}),t=r.getView().calculateExtent(r.getSize()),$(".ol-attribution > button > span").html("©"),$(document).ready(function(){f()})};return{getMap:d,updateMapSize:f,updateLayerSourceParams:p,updateLayerAttribute:y,addMousePosition:h,removeMousePosition:L,addScale:b,removeScale:x,enableDoubleClickZoom:C,disableDoubleClickZoom:M,addLayerGroup:E,createTileWMS:S,addTileWMSLayer:T,addGeoJSONVectorLayer:G,removeLayer:V,addBaseLayers:W,addOSMLayer:O,addMapQuestOSMLayer:R,addMapQuestSatelliteLayer:F,setLayersStartLoadingFunction:P,setLayersEndLoadingFunction:_,setLayerVisibility:D,setLayerVisibilityById:q,isLayerVisible:N,setLayerVisibilityChangeEvent:Q,addZoomDragBox:j,removeZoomDragBox:z,getZoomDragBoxExtent:Z,setZoomDragBoxStartEvent:K,setZoomDragBoxEndEvent:U,getCurrentExtent:J,zoomToInitialExtent:Y,zoomToExtent:X,getCurrentResolution:H,isCurrentResolutionValidForLayer:ee,setMapResolutionChangeEvent:te,setMapDoubleClickEvent:ne,setMapSingleClickEvent:re,unsetMapSingleClickEvent:oe,setGetFeatureInfoUrlOnClick:ie,unsetGetFeatureInfoUrlOnClick:ae,findBy:le,applyCQLFilter:ue,alterLayerIndex:se,init:ce}}),n("TerraMA2WebComponentsPath/components/LayerExplorer.TerraMA2WebComponents",["TerraMA2WebComponentsPath/components/MapDisplay.TerraMA2WebComponents"],function(e){var t=null,n=null,r=null,o=function(){return t},i=function(e,t,n,r,o){return o=""!==o?" "+o:o,"<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='parent_li"+o+"'><span class='group-name'><div class='terrama2-layerexplorer-plus'>+</div><span>"+t+"</span></span><ul class='children'>"+r+"</ul></li>"},a=function(e,t,n,r,o,i){var a=r?"<input type='checkbox' class='terrama2-layerexplorer-checkbox' checked/>":"<input type='checkbox' class='terrama2-layerexplorer-checkbox'/>";return i=""!==i?i+" ":i,i+=o?"layer disabled-content":"layer","<li data-layerid='"+e+"' data-parentid='"+n+"' id='"+e.replace(":","")+"' class='"+i+"'>"+a+"<span class='terrama2-layerexplorer-checkbox-span'>"+t+"</span></li>"},l=function(e,t,o,i){o=null!==o&&void 0!==o?o:!1,i=null!==i&&void 0!==i?i:"";var a=n.findBy(r.getLayerGroup(),"id",e);if(null!==a){a.classes=i;var l=s(a,t);"terrama2-layerexplorer"===t?o?$("#"+t).append(l):$("#"+t).prepend(l):o?$("#"+t+" > ul.children").append(l):$("#"+t+" > ul.children").prepend(l),$("input.opacity").slider(),$(".parent_li").find(" > ul > li").hide(),d()}},u=function(e,t){$("#"+e.replace(":","")).remove(),n.removeLayer(e,t)},s=function(e,t){var n="";if(e.getLayers){for(var r="",o=e.getLayers().getArray(),l=o.length,u=0;l>u;u++){var c=r;r=s(o[u],e.get("id"))+c}$("#"+e.get("id").replace(":","")).length||(n=i(e.get("id"),e.get("name"),t,r,e.classes))}else $("#"+e.get("id").replace(":","")).length||(n=a(e.get("id"),e.get("name"),t,e.get("visible"),e.get("disabled"),e.classes));return n},c=function(){$("#terrama2-layerexplorer").on("click","span.group-name",function(e){var t=$(this).parent("li.parent_li").find(" > ul > li");t.is(":visible")?(t.hide("fast"),$(this).find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+"),$(this).parent("li.parent_li").removeClass("open")):(t.show("fast"),$(this).find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"),$(this).parent("li.parent_li").addClass("open"))}),$("input.opacity").on("slide",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);o.setOpacity(e.value)}),$("#terrama2-layerexplorer").on("click","input.terrama2-layerexplorer-checkbox",function(e){var t=$(this).closest("li").data("layerid"),o=n.findBy(r.getLayerGroup(),"id",t);if(null!==o){n.setLayerVisibility(o);var i=$(this).parent("li.parent_li").find(" > ul > li"),a=$(this).parent("li.parent_li").find(" > span");i.is(":visible")||!o.getVisible()?(i.hide("fast"),a.find("div").addClass("terrama2-layerexplorer-plus").removeClass("terrama2-layerexplorer-minus").html("+")):(i.show("fast"),a.find("div").addClass("terrama2-layerexplorer-minus").removeClass("terrama2-layerexplorer-plus").html("-"))}e.stopPropagation()}),$("#terrama2-layerexplorer").on("click","li.layer",function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t=null):($("li.parent_li ul li").removeClass("selected"),$(this).addClass("selected"),t=$(this).attr("data-layerid"))})},d=function(){$(".children").sortable({items:"li:not(.unsortable)",start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$(".children").disableSelection(),$("#terrama2-layerexplorer").sortable({items:"li:not(.unsortable)",start:function(e,t){$(this).attr("data-previndex",t.item.context.parentNode.childElementCount-2-t.item.index())},update:function(t,n){e.alterLayerIndex(n.item.attr("data-parentid"),$(this).attr("data-previndex"),n.item.context.parentNode.childElementCount-1-n.item.index()),$(this).removeAttr("data-previndex")}}),$("#terrama2-layerexplorer").disableSelection()},f=function(){n=e,r=n.getMap(),c()};return{getSelectedLayer:o,addLayersFromMap:l,removeLayer:u,init:f}}),t("TerraMA2WebComponents")});